<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hazida ¬∑ quotations with sidebar & saved list</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;
    }

    body {
      background-color: #eef2f5;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 1rem;
    }

    /* main app layout with sidebar */
    .app {
      display: flex;
      width: 100%;
      max-width: 1600px;
      background: white;
      border-radius: 32px;
      box-shadow: 0 25px 50px -12px rgba(0,32,64,0.3);
      overflow: hidden;
      min-height: 90vh;
    }

    /* SIDEBAR - always visible, shows saved quotations */
    .sidebar {
      width: 300px;
      background: #f5f9ff;
      border-right: 1px solid #d0e0f0;
      padding: 2rem 1.2rem;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
    }

    .sidebar-header {
      font-weight: 700;
      font-size: 1.8rem;
      color: #0b2942;
      margin-bottom: 2rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid #b9cee6;
    }

    .sidebar-header span {
      font-size: 1rem;
      background: #0b2942;
      color: white;
      padding: 0.2rem 0.8rem;
      border-radius: 40px;
      margin-left: 8px;
    }

    .new-quote-btn {
      background: #0b2942;
      color: white;
      border: none;
      padding: 1rem;
      border-radius: 40px;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      margin-bottom: 2rem;
      box-shadow: 0 8px 16px rgba(0,40,70,0.2);
      border: 1px solid #204b70;
    }

    .saved-title {
      font-weight: 600;
      color: #1d446b;
      margin-bottom: 1.2rem;
      font-size: 1.1rem;
    }

    .saved-list {
      flex: 1;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 0.8rem;
    }

    .saved-item {
      background: white;
      border: 1px solid #c9dcf0;
      border-radius: 18px;
      padding: 1rem;
      cursor: pointer;
      transition: all 0.1s;
      box-shadow: 0 2px 6px rgba(0,0,0,0.02);
    }

    .saved-item:hover {
      background: #eaf3fd;
      border-color: #97b9dc;
    }

    .saved-item .quote-ref {
      font-weight: 700;
      color: #0b2942;
    }

    .saved-item .quote-customer {
      font-size: 0.9rem;
      color: #345d86;
      margin: 0.3rem 0;
    }

    .saved-item .quote-total {
      font-weight: 600;
      color: #003366;
    }

    .saved-item .quote-date {
      font-size: 0.75rem;
      color: #6f8eb0;
    }

    /* MAIN CONTENT */
    .main {
      flex: 1;
      background: white;
      padding: 2rem 2.5rem;
      overflow-y: auto;
      max-height: 90vh;
    }

    .main-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }

    .main-header h2 {
      font-size: 2rem;
      font-weight: 600;
      color: #111;
    }

    .quote-number {
      background: #eaf1fb;
      padding: 0.5rem 1.5rem;
      border-radius: 40px;
      font-weight: 600;
      color: #003366;
    }

    /* customer panel */
    .customer-panel {
      background: #f2f7fd;
      border-radius: 24px;
      padding: 1.5rem 2rem;
      margin-bottom: 2rem;
      display: flex;
      flex-wrap: wrap;
      gap: 2rem;
      border: 1px solid #dbe7f2;
    }

    .customer-field {
      display: flex;
      flex-direction: column;
      min-width: 220px;
    }

    .customer-field label {
      font-weight: 600;
      font-size: 0.75rem;
      text-transform: uppercase;
      color: #2f557a;
      margin-bottom: 0.2rem;
    }

    .customer-field input {
      border: 1px solid #c1d4e8;
      border-radius: 14px;
      padding: 0.7rem 1.2rem;
      font-size: 1rem;
      background: white;
    }

    /* job card */
    .job-card {
      background: #ffffff;
      border: 1px solid #e2eaf2;
      border-radius: 24px;
      padding: 1.8rem 2rem;
      margin-bottom: 2rem;
      box-shadow: 0 6px 14px rgba(0,0,0,0.02);
    }

    .job-header {
      display: flex;
      align-items: center;
      gap: 1.5rem;
      margin-bottom: 1.8rem;
      flex-wrap: wrap;
    }

    .job-header input {
      font-size: 1.2rem;
      font-weight: 600;
      border: 1px solid #c6d8ec;
      border-radius: 40px;
      padding: 0.6rem 1.5rem;
      width: 320px;
      background: #f9fcff;
    }

    .job-header .remove-job {
      background: none;
      border: 1px solid #e0b3b3;
      padding: 0.4rem 1.5rem;
      border-radius: 40px;
      color: #aa4a4a;
      font-weight: 500;
      cursor: pointer;
      margin-left: auto;
    }

    /* materials table */
    .mat-table-wrapper {
      border-radius: 18px;
      border: 1px solid #d9e5f0;
      overflow: auto;
      margin: 1rem 0 1.2rem;
      background: white;
    }

    .mat-table {
      width: 100%;
      border-collapse: collapse;
      min-width: 600px;
    }

    .mat-table th {
      background: #ecf3fa;
      color: #1d446b;
      font-weight: 600;
      font-size: 0.8rem;
      text-transform: uppercase;
      padding: 1rem 1rem;
      text-align: left;
      border-bottom: 1px solid #c9daec;
    }

    .mat-table td {
      padding: 0.9rem 1rem;
      border-bottom: 1px solid #e2ecf5;
      vertical-align: middle;
    }

    .mat-table input {
      width: 100%;
      border: 1px solid #d0ddee;
      border-radius: 12px;
      padding: 0.5rem 0.8rem;
      background: white;
      font-size: 0.95rem;
    }

    .mat-table input:focus {
      border-color: #1f6eaf;
      outline: none;
      box-shadow: 0 0 0 2px rgba(20,100,180,0.1);
    }

    .remove-mat {
      background: none;
      border: none;
      font-size: 1.2rem;
      color: #b24747;
      cursor: pointer;
      padding: 0 0.3rem;
    }

    .add-material-btn {
      background: white;
      border: 1.5px dashed #9bb4cf;
      border-radius: 30px;
      padding: 0.5rem 1.8rem;
      font-weight: 500;
      color: #1e4870;
      cursor: pointer;
      margin-top: 0.5rem;
    }

    .add-job-btn {
      background: white;
      border: 2px dashed #9bb4cf;
      border-radius: 40px;
      padding: 1rem 2.5rem;
      font-size: 1rem;
      font-weight: 600;
      color: #1e4870;
      cursor: pointer;
      margin: 1rem 0 2rem;
      width: fit-content;
    }

    /* indirect costs */
    .indirect-section {
      background: #f5faff;
      border-radius: 24px;
      padding: 1.8rem 2rem;
      margin: 2.2rem 0 1.8rem;
      border: 1px solid #cde0f0;
    }

    .section-title {
      font-size: 1.3rem;
      font-weight: 600;
      color: #113753;
      margin-bottom: 1.2rem;
    }

    .indirect-table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 16px;
      overflow: hidden;
      border: 1px solid #d2e1f2;
    }

    .indirect-table th {
      background: #e6f0fa;
      padding: 1rem 1.5rem;
      font-weight: 600;
      color: #1d4a79;
    }

    .indirect-table td {
      padding: 0.8rem 1.5rem;
      border-bottom: 1px solid #deeaf5;
    }

    .indirect-table input {
      border: 1px solid #c7d9ec;
      border-radius: 12px;
      padding: 0.6rem 1.2rem;
      width: 240px;
    }

    .add-indirect-btn {
      background: white;
      border: 1.5px dashed #98b6d4;
      border-radius: 30px;
      padding: 0.6rem 2rem;
      font-weight: 500;
      color: #1e4870;
      cursor: pointer;
      margin-top: 1rem;
    }

    /* labour, markup, grand */
    .labour-markup-row {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      background: #f3f9ff;
      border-radius: 22px;
      padding: 1.4rem 2rem;
      margin: 1.5rem 0 2rem;
      border: 1px solid #c9dcf0;
    }

    .lm-block {
      display: flex;
      gap: 2rem;
      flex-wrap: wrap;
    }

    .lm-item {
      display: flex;
      align-items: center;
      gap: 0.8rem;
    }

    .lm-item label {
      font-weight: 600;
      color: #20466b;
      width: 80px;
    }

    .lm-item input {
      border: 1px solid #b5ceea;
      border-radius: 30px;
      padding: 0.7rem 1.4rem;
      width: 160px;
    }

    .grand-total-box {
      font-size: 1.9rem;
      font-weight: 800;
      color: #003366;
      background: #e2edfe;
      padding: 0.6rem 2rem;
      border-radius: 60px;
      border: 1px solid #aac3e0;
    }

    .action-buttons {
      display: flex;
      gap: 1.5rem;
      flex-wrap: wrap;
      margin: 1.5rem 0;
    }

    .save-btn, .pdf-btn {
      background: #0b2942;
      border: none;
      color: white;
      font-weight: 600;
      padding: 0.9rem 2.5rem;
      border-radius: 40px;
      cursor: pointer;
      border: 1px solid #204b70;
      font-size: 1rem;
    }

    .save-btn { background: #1d4e7c; }

    .hidden {
      display: none;
    }
  </style>
</head>
<body>
<div class="app">
  <!-- SIDEBAR with saved quotations list -->
  <aside class="sidebar">
    <div class="sidebar-header">HAZIDA<span>quote</span></div>
    <button class="new-quote-btn" id="newQuoteBtn">Ôºã create new quotation</button>
    <div class="saved-title">üìÅ saved quotations</div>
    <div class="saved-list" id="savedListSidebar">
      <!-- populated dynamically -->
    </div>
  </aside>

  <!-- MAIN CONTENT (create/edit quotation) -->
  <main class="main" id="mainContent">
    <!-- content will be injected by JS -->
  </main>
</div>

<script>
  (function() {
    // --- STATE ---
    let jobs = [];
    let indirectItems = [];
    let labour = 1950;
    let markup = 13.5;
    let customer = { name: 'John Mwale', address: 'Plot 17, Lusaka' };
    let currentQuoteId = null; // for editing

    // Load saved quotes from localStorage
    let savedQuotes = JSON.parse(localStorage.getItem('hazida_quotes')) || [];

    // Generate unique quote number
    let quoteNum = Math.floor(Math.random() * 9000 + 1000);

    // --- Helper functions ---
    function genId() { return 'job_' + Date.now() + Math.random().toString(36).substring(2,6); }
    function matId() { return 'mat_' + Date.now() + Math.random().toString(36).substring(2,8); }

    // --- Render main content (create new quotation) ---
    function renderMain() {
      const main = document.getElementById('mainContent');
      let html = `
        <div class="main-header">
          <h2>create quotation</h2>
          <span class="quote-number">#Q-${quoteNum}</span>
        </div>

        <!-- customer panel -->
        <div class="customer-panel">
          <div class="customer-field"><label>customer name</label><input type="text" id="custName" value="${customer.name}"></div>
          <div class="customer-field"><label>customer address</label><input type="text" id="custAddress" value="${customer.address}"></div>
        </div>
      `;

      // jobs
      if (jobs.length === 0) {
        html += `<div style="background:#f9fcff; border-radius:28px; padding:3rem; text-align:center; color:#5f7d9c; border:1px dashed #bcd0e6; margin-bottom:1.5rem;">‚Äî no jobs added ‚Äî</div>`;
      } else {
        jobs.forEach((job, jIdx) => {
          html += `<div class="job-card" data-job-id="${job.id}">`;
          html += `<div class="job-header">`;
          html += `<input type="text" value="${job.name}" placeholder="job description" class="job-name-input" data-job-idx="${jIdx}">`;
          html += `<button class="remove-job" data-job-id="${job.id}">remove job</button>`;
          html += `</div>`;

          html += `<div class="mat-table-wrapper"><table class="mat-table"><thead><tr><th>material</th><th>qty</th><th>unit price (ZMW)</th><th>supplier</th><th>amount</th><th></th></tr></thead><tbody id="mat-body-${job.id}">`;

          if (job.materials.length === 0) {
            html += `<tr><td colspan="6" style="padding:1.5rem; text-align:center;">‚Äî no materials ‚Äî</td></tr>`;
          } else {
            job.materials.forEach((mat, mIdx) => {
              let amt = (mat.qty * mat.price).toFixed(2);
              html += `<tr>
                <td><input type="text" value="${mat.desc.replace(/"/g, '&quot;')}" data-job-idx="${jIdx}" data-mat-idx="${mIdx}" class="mat-desc"></td>
                <td><input type="number" value="${mat.qty}" step="0.1" min="0" data-job-idx="${jIdx}" data-mat-idx="${mIdx}" class="mat-qty"></td>
                <td><input type="number" value="${mat.price}" step="0.01" min="0" data-job-idx="${jIdx}" data-mat-idx="${mIdx}" class="mat-price"></td>
                <td><input type="text" value="${mat.supplier.replace(/"/g, '&quot;')}" data-job-idx="${jIdx}" data-mat-idx="${mIdx}" class="mat-supplier"></td>
                <td>${amt} ZMW</td>
                <td><button class="remove-mat" data-job-id="${job.id}" data-mat-id="${mat.id}">‚úï</button></td>
              </tr>`;
            });
          }
          html += `</tbody></table></div>`;
          html += `<button class="add-material-btn" data-job-id="${job.id}">‚ûï add material</button>`;
          html += `</div>`;
        });
      }
      html += `<button class="add-job-btn" id="addJobBtn">‚ûï add new job</button>`;

      // indirect section
      html += `<div class="indirect-section"><div class="section-title">indirect costs (ZMW)</div>`;
      html += `<table class="indirect-table"><thead><tr><th>description</th><th>amount</th><th></th></tr></thead><tbody id="indirectBody">`;
      if (indirectItems.length === 0) {
        html += `<tr><td colspan="3" style="padding:1rem; text-align:center;">‚Äî none ‚Äî</td></tr>`;
      } else {
        indirectItems.forEach((item, idx) => {
          html += `<tr>
            <td><input type="text" value="${item.name.replace(/"/g, '&quot;')}" data-ind-idx="${idx}" class="indirect-name"></td>
            <td><input type="number" value="${item.value}" step="1" min="0" data-ind-idx="${idx}" class="indirect-value"></td>
            <td><button class="remove-indirect-btn" data-ind-idx="${idx}">‚úï</button></td>
          </tr>`;
        });
      }
      html += `</tbody></table><button class="add-indirect-btn" id="addIndirectBtn">‚ûï add indirect cost</button></div>`;

      // labour, markup, grand
      html += `
        <div class="labour-markup-row">
          <div class="lm-block">
            <div class="lm-item"><label>labour</label><input type="number" id="labourInput" value="${labour}"></div>
            <div class="lm-item"><label>markup %</label><input type="number" id="markupInput" value="${markup}" step="0.5"></div>
          </div>
          <div class="grand-total-box" id="grandTotalDisplay">0.00 ZMW</div>
        </div>
      `;

      // action buttons
      html += `
        <div class="action-buttons">
          <button class="save-btn" id="saveQuoteBtn">üíæ save quotation</button>
          <button class="pdf-btn" id="downloadPdfBtn">üìé PDF quotation</button>
        </div>
      `;

      main.innerHTML = html;
      attachMainEvents();
      updateGrandTotal();
    }

    // --- Attach events for main content ---
    function attachMainEvents() {
      // customer
      document.getElementById('custName')?.addEventListener('input', (e) => customer.name = e.target.value);
      document.getElementById('custAddress')?.addEventListener('input', (e) => customer.address = e.target.value);

      // job name
      document.querySelectorAll('.job-name-input').forEach(inp => {
        inp.addEventListener('input', (e) => {
          let idx = e.target.dataset.jobIdx;
          if (idx !== undefined) jobs[idx].name = e.target.value;
        });
      });

      // remove job
      document.querySelectorAll('.remove-job').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.preventDefault();
          let jobId = e.target.dataset.jobId;
          jobs = jobs.filter(j => j.id !== jobId);
          renderMain();
        });
      });

      // add material
      document.querySelectorAll('.add-material-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.preventDefault();
          let jobId = e.target.dataset.jobId;
          let job = jobs.find(j => j.id === jobId);
          if (job) {
            job.materials.push({ id: matId(), desc: 'new material', qty: 1, price: 100, supplier: '‚Äî' });
            renderMain();
          }
        });
      });

      // remove material
      document.querySelectorAll('.remove-mat').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.preventDefault();
          let jobId = e.target.dataset.jobId;
          let matId = e.target.dataset.matId;
          let job = jobs.find(j => j.id === jobId);
          if (job) {
            job.materials = job.materials.filter(m => m.id !== matId);
            renderMain();
          }
        });
      });

      // material input updates
      document.querySelectorAll('.mat-desc, .mat-qty, .mat-price, .mat-supplier').forEach(inp => {
        inp.addEventListener('input', function(e) {
          let jIdx = this.dataset.jobIdx;
          let mIdx = this.dataset.matIdx;
          if (jIdx === undefined || mIdx === undefined) return;
          let job = jobs[jIdx];
          let mat = job.materials[mIdx];
          if (this.classList.contains('mat-desc')) mat.desc = this.value;
          else if (this.classList.contains('mat-qty')) mat.qty = parseFloat(this.value) || 0;
          else if (this.classList.contains('mat-price')) mat.price = parseFloat(this.value) || 0;
          else if (this.classList.contains('mat-supplier')) mat.supplier = this.value;
          updateGrandTotal();
        });
      });

      document.getElementById('addJobBtn')?.addEventListener('click', () => {
        jobs.push({ id: genId(), name: 'New job', materials: [] });
        renderMain();
      });

      // indirect
      document.querySelectorAll('.indirect-name').forEach(inp => {
        inp.addEventListener('input', function(e) {
          let idx = this.dataset.indIdx;
          if (idx !== undefined) indirectItems[idx].name = this.value;
          updateGrandTotal();
        });
      });
      document.querySelectorAll('.indirect-value').forEach(inp => {
        inp.addEventListener('input', function(e) {
          let idx = this.dataset.indIdx;
          if (idx !== undefined) {
            let val = parseFloat(this.value);
            indirectItems[idx].value = isNaN(val) ? 0 : val;
            updateGrandTotal();
          }
        });
      });
      document.querySelectorAll('.remove-indirect-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          let idx = e.target.dataset.indIdx;
          if (idx !== undefined) { indirectItems.splice(idx, 1); renderMain(); }
        });
      });
      document.getElementById('addIndirectBtn')?.addEventListener('click', () => {
        indirectItems.push({ name: 'new cost', value: 150 });
        renderMain();
      });

      // labour & markup
      const labourInp = document.getElementById('labourInput');
      const markupInp = document.getElementById('markupInput');
      if (labourInp) labourInp.addEventListener('input', function() { labour = parseFloat(this.value) || 0; updateGrandTotal(); });
      if (markupInp) markupInp.addEventListener('input', function() { markup = parseFloat(this.value) || 0; updateGrandTotal(); });

      // save
      document.getElementById('saveQuoteBtn')?.addEventListener('click', saveQuote);
      // pdf
      document.getElementById('downloadPdfBtn')?.addEventListener('click', generatePDF);
    }

    // --- Update grand total display ---
    function updateGrandTotal() {
      let grandSpan = document.getElementById('grandTotalDisplay');
      if (!grandSpan) return;

      let materialsTotal = jobs.reduce((acc, job) => acc + job.materials.reduce((s, m) => s + (m.qty * m.price), 0), 0);
      let indirectSum = indirectItems.reduce((acc, i) => acc + (i.value || 0), 0);
      let labourVal = parseFloat(document.getElementById('labourInput')?.value) || 0;
      let markupVal = parseFloat(document.getElementById('markupInput')?.value) || 0;
      let subtotal = materialsTotal + indirectSum + labourVal;
      let grand = subtotal + (subtotal * markupVal / 100);
      grandSpan.innerText = grand.toFixed(2) + ' ZMW';
    }

    // --- Save quotation ---
    function saveQuote() {
      let materialsTotal = jobs.reduce((acc, job) => acc + job.materials.reduce((s, m) => s + (m.qty * m.price), 0), 0);
      let indirectSum = indirectItems.reduce((acc, i) => acc + (i.value || 0), 0);
      let labourVal = parseFloat(document.getElementById('labourInput')?.value) || 0;
      let markupVal = parseFloat(document.getElementById('markupInput')?.value) || 0;
      let subtotal = materialsTotal + indirectSum + labourVal;
      let grand = subtotal + (subtotal * markupVal / 100);

      let quote = {
        id: currentQuoteId || Date.now(),
        quoteNum: quoteNum,
        customer: { name: customer.name, address: customer.address },
        jobs: JSON.parse(JSON.stringify(jobs)),
        indirect: JSON.parse(JSON.stringify(indirectItems)),
        labour: labourVal,
        markup: markupVal,
        grand: grand,
        date: new Date().toLocaleDateString()
      };

      if (currentQuoteId) {
        // update existing
        let index = savedQuotes.findIndex(q => q.id === currentQuoteId);
        if (index !== -1) savedQuotes[index] = quote;
      } else {
        savedQuotes.push(quote);
      }

      localStorage.setItem('hazida_quotes', JSON.stringify(savedQuotes));
      renderSidebarList();
      alert('Quotation saved!');
    }

    // --- Render saved list in sidebar ---
    function renderSidebarList() {
      const listDiv = document.getElementById('savedListSidebar');
      if (savedQuotes.length === 0) {
        listDiv.innerHTML = '<div style="color:#6f8eb0; padding:1rem;">‚Äî no saved quotations ‚Äî</div>';
        return;
      }

      let html = '';
      savedQuotes.slice().reverse().forEach((q, index) => {
        html += `
          <div class="saved-item" data-quote-id="${q.id}">
            <div class="quote-ref">#Q-${q.quoteNum}</div>
            <div class="quote-customer">${q.customer.name || 'No name'}</div>
            <div class="quote-total">${q.grand.toFixed(2)} ZMW</div>
            <div class="quote-date">${q.date}</div>
          </div>
        `;
      });
      listDiv.innerHTML = html;

      // add click listeners to load quote
      document.querySelectorAll('.saved-item').forEach(item => {
        item.addEventListener('click', (e) => {
          let quoteId = item.dataset.quoteId;
          let quote = savedQuotes.find(q => q.id == quoteId);
          if (quote) {
            loadQuote(quote);
          }
        });
      });
    }

    // --- Load a saved quote ---
    function loadQuote(quote) {
      jobs = quote.jobs;
      indirectItems = quote.indirect;
      customer = { name: quote.customer.name, address: quote.customer.address };
      labour = quote.labour;
      markup = quote.markup;
      quoteNum = quote.quoteNum;
      currentQuoteId = quote.id;
      renderMain();
    }

    // --- Create new blank quotation ---
    function newQuote() {
      jobs = [];
      indirectItems = [];
      labour = 1950;
      markup = 13.5;
      customer = { name: '', address: '' };
      quoteNum = Math.floor(Math.random() * 9000 + 1000);
      currentQuoteId = null;
      renderMain();
    }

    // --- Generate PDF ---
    function generatePDF() {
      let materialsTotal = jobs.reduce((acc, job) => acc + job.materials.reduce((s, m) => s + (m.qty * m.price), 0), 0);
      let indirectSum = indirectItems.reduce((acc, i) => acc + (i.value || 0), 0);
      let labourVal = parseFloat(document.getElementById('labourInput')?.value) || 0;
      let markupVal = parseFloat(document.getElementById('markupInput')?.value) || 0;
      let subtotal = materialsTotal + indirectSum + labourVal;
      let markupAmount = subtotal * (markupVal / 100);
      let grand = subtotal + markupAmount;

      let rows = '';
      jobs.forEach(job => {
        job.materials.forEach(mat => {
          rows += `<tr><td>${job.name} ‚Äì ${mat.desc}</td><td>${mat.qty}</td><td>${mat.price.toFixed(2)} ZMW</td><td>${mat.supplier}</td><td>${(mat.qty*mat.price).toFixed(2)} ZMW</td></tr>`;
        });
      });
      if (!rows) rows = '<tr><td colspan="5">‚Äî</td></tr>';

      let indRows = '';
      indirectItems.forEach(i => { indRows += `<div style="display:flex;justify-content:space-between;"><span>${i.name}</span><span>${i.value.toFixed(2)} ZMW</span></div>`; });

      let printWin = window.open('', '_blank');
      printWin.document.write(`
        <html><head><title>Hazida Quotation</title><style>
          body { font-family: Inter, Arial; padding:2rem; max-width:1000px; margin:auto; }
          h2 { color:#0b2942; } .customer { margin:1rem 0; }
          table { width:100%; border-collapse:collapse; margin:1.5rem 0; }
          th { background:#ecf3fa; padding:0.8rem; text-align:left; }
          td { padding:0.7rem; border-bottom:1px solid #d5e2f0; }
          .totals { background:#f5f9ff; padding:1.5rem; border-radius:20px; margin-top:2rem; }
          .row { display:flex; justify-content:space-between; padding:0.4rem 0; }
          .grand { font-weight:800; font-size:1.8rem; border-top:2px solid #a0b8d0; }
        </style></head>
        <body>
        <h2>HAZIDA LIMITED</h2>
        <div class="customer"><strong>Customer:</strong> ${customer.name}<br><strong>Address:</strong> ${customer.address}</div>
        <table><thead><tr><th>job / material</th><th>qty</th><th>unit price</th><th>supplier</th><th>total</th></tr></thead><tbody>${rows}</tbody></table>
        <div class="totals">
          <div class="row"><span>Materials</span><span>${materialsTotal.toFixed(2)} ZMW</span></div>
          ${indRows}
          <div class="row"><span>Indirect total</span><span>${indirectSum.toFixed(2)} ZMW</span></div>
          <div class="row"><span>Labour</span><span>${labourVal.toFixed(2)} ZMW</span></div>
          <div class="row"><span>Markup ${markupVal}%</span><span>${markupAmount.toFixed(2)} ZMW</span></div>
          <div class="row grand"><span>GRAND TOTAL</span><span>${grand.toFixed(2)} ZMW</span></div>
        </div>
        <p style="margin-top:2rem;">‚Äî Hazida Limited ¬∑ valid for 30 days ‚Äî</p>
        <script>window.onload=()=>window.print();<\/script>
        </body></html>
      `);
      printWin.document.close();
    }

    // --- Event listeners ---
    document.getElementById('newQuoteBtn')?.addEventListener('click', newQuote);

    // --- Initial render ---
    renderSidebarList();
    newQuote(); // start with blank quotation
  })();
</script>
</body>
</html>
