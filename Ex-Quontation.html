<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Penta ¬∑ quotation with full task & material list</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    body {
      background-color: #ffffff;
      min-height: 100vh;
      width: 100%;
      display: flex;
    }

    .app {
      display: flex;
      width: 100vw;
      min-height: 100vh;
      background-color: white;
    }

    /* sidebar ‚Äì toggle works perfectly */
    .sidebar {
      width: 260px;
      background-color: #fafbfc;
      border-right: 1px solid #eef0f2;
      padding: 2rem 1rem;
      display: flex;
      flex-direction: column;
      transition: margin-left 0.2s ease-in-out;
      overflow: hidden;
      flex-shrink: 0;
      margin-left: 0;
    }

    .sidebar.hidden {
      margin-left: -260px;
    }

    .sidebar-header {
      font-weight: 600;
      font-size: 1.5rem;
      letter-spacing: -0.5px;
      padding: 0 0.75rem 2rem 0.75rem;
      color: #111;
    }

    .sidebar-header span {
      background: #111;
      color: white;
      font-size: 1rem;
      padding: 0.2rem 0.8rem;
      border-radius: 40px;
      margin-left: 6px;
    }

    .nav {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .nav a {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 0.85rem 1rem;
      border-radius: 14px;
      font-weight: 500;
      color: #1e1e2f;
      text-decoration: none;
      font-size: 1rem;
    }

    .nav a:hover {
      background-color: #f0f2f5;
    }

    .nav a.active {
      background-color: #eaeef3;
      color: #0a0a0a;
      font-weight: 550;
    }

    .icon {
      font-size: 1.35rem;
    }

    .logout-area {
      margin-top: 2.5rem;
      padding-top: 1.5rem;
      border-top: 1px solid #e2e6ea;
    }

    .logout-btn {
      background: none;
      border: none;
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 0.85rem 1rem;
      width: 100%;
      font-size: 1rem;
      font-weight: 500;
      color: #b02e2e;
      border-radius: 14px;
      cursor: pointer;
    }

    .logout-btn:hover {
      background-color: #ffe9e9;
    }

    /* MAIN CONTENT */
    .main {
      flex: 1;
      display: flex;
      flex-direction: column;
      background-color: #ffffff;
      min-width: 0;
    }

    .top-bar {
      display: flex;
      align-items: center;
      padding: 1.5rem 2.5rem;
      background: white;
      border-bottom: 1px solid #f0f2f5;
    }

    .toggle-btn {
      background: none;
      border: 1px solid #e2e6ea;
      font-size: 1.7rem;
      width: 48px;
      height: 48px;
      border-radius: 50%;
      cursor: pointer;
      color: #222;
      margin-right: 1.5rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .toggle-btn:hover {
      background-color: #f6f8fa;
    }

    .page-title {
      font-size: 1.9rem;
      font-weight: 600;
      letter-spacing: -0.02em;
      color: #111;
    }

    /* Quotation builder */
    .quotation-builder {
      padding: 2rem 2.5rem;
      overflow-y: auto;
      background: white;
    }

    .section-head {
      font-size: 1.4rem;
      font-weight: 600;
      margin: 1.8rem 0 1rem 0;
      color: #1f2a3a;
      border-left: 6px solid #76879e;
      padding-left: 1rem;
    }

    .task-card {
      background: #ffffff;
      border: 1px solid #e4eaf2;
      border-radius: 24px;
      padding: 1.5rem 1.8rem;
      margin-bottom: 2.2rem;
      box-shadow: 0 5px 12px rgba(0,0,0,0.02);
    }

    .task-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.6rem;
      flex-wrap: wrap;
    }

    .task-name-label {
      font-weight: 600;
      font-size: 1.2rem;
      color: #1f2a3a;
      background: #edf3f9;
      padding: 0.4rem 1.4rem;
      border-radius: 40px;
      border: 1px solid #d7e0e9;
    }

    .task-name-input {
      font-size: 1.2rem;
      font-weight: 600;
      border: 1px solid #cbd8e8;
      border-radius: 40px;
      padding: 0.5rem 1.5rem;
      width: 320px;
      background: white;
    }

    .remove-task-btn {
      background: none;
      border: 1px solid #e0b3b3;
      font-size: 1.2rem;
      padding: 0.3rem 1.2rem;
      border-radius: 40px;
      color: #aa4a4a;
      cursor: pointer;
      margin-left: auto;
      font-weight: 500;
    }

    .material-table {
      width: 100%;
      border-collapse: collapse;
      background: #fbfdff;
      border-radius: 20px;
      border: 1px solid #e2eaf2;
      margin: 1rem 0 0.8rem 0;
    }

    .material-table th {
      text-align: left;
      padding: 0.9rem 1rem;
      background: #e9f0f7;
      font-weight: 600;
      font-size: 0.85rem;
      color: #1f3b54;
    }

    .material-table td {
      padding: 0.8rem 1rem;
      border-top: 1px solid #e2eaf2;
      vertical-align: middle;
    }

    .material-table input {
      width: 100%;
      border: 1px solid #cfddee;
      border-radius: 14px;
      padding: 0.65rem 1rem;
      font-size: 0.9rem;
      background: white;
    }

    .remove-material-btn {
      background: none;
      border: none;
      font-size: 1.3rem;
      color: #b45a5a;
      cursor: pointer;
      padding: 0 0.3rem;
    }

    .add-material-btn {
      background: white;
      border: 1.5px dashed #9bb4cf;
      border-radius: 30px;
      padding: 0.5rem 1.8rem;
      font-weight: 500;
      color: #1e3b5c;
      cursor: pointer;
      margin: 0.6rem 0 0.2rem 0;
      font-size: 0.9rem;
    }

    .indirect-table {
      width: 100%;
      border-collapse: collapse;
      background: #ffffff;
      border: 1px solid #e2eaf2;
      border-radius: 20px;
      margin: 1rem 0;
    }

    .indirect-table th {
      background: #e9f0f7;
      padding: 0.9rem 1.5rem;
      text-align: left;
      font-weight: 600;
      color: #1f3b54;
    }

    .indirect-table td {
      padding: 0.8rem 1.5rem;
      border-top: 1px solid #e2eaf2;
    }

    .indirect-table input {
      border: 1px solid #cfddee;
      border-radius: 14px;
      padding: 0.6rem 1rem;
      width: 200px;
    }

    .remove-indirect-btn {
      background: none;
      border: none;
      font-size: 1.2rem;
      color: #b45a5a;
      cursor: pointer;
      margin-left: 1rem;
    }

    .add-indirect-btn {
      background: white;
      border: 1.5px dashed #9bb4cf;
      border-radius: 30px;
      padding: 0.5rem 1.8rem;
      font-weight: 500;
      color: #1e3b5c;
      cursor: pointer;
      margin: 0.5rem 0 1.5rem 0;
    }

    .labour-markup-panel {
      display: flex;
      flex-wrap: wrap;
      gap: 3rem;
      background: #f6faff;
      border-radius: 28px;
      padding: 1.8rem 2.5rem;
      margin: 2rem 0 1.8rem;
      border: 1px solid #deeaf5;
    }

    .lm-item {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .lm-item label {
      font-weight: 600;
      color: #1e3b5c;
      width: 100px;
    }

    .lm-item input {
      border: 1px solid #cbd6e4;
      border-radius: 40px;
      padding: 0.7rem 1.4rem;
      width: 180px;
      font-size: 1rem;
    }

    .generate-btn {
      background: #0c202f;
      border: none;
      color: white;
      font-weight: 700;
      font-size: 1.3rem;
      padding: 1rem 3rem;
      border-radius: 60px;
      cursor: pointer;
      margin: 1.5rem 0 2.5rem 0;
      box-shadow: 0 8px 18px rgba(0,40,70,0.2);
      border: 1px solid #17334b;
    }

    .add-task-main-btn {
      background: white;
      border: 2px dashed #9bb4cf;
      border-radius: 40px;
      padding: 1rem 2.5rem;
      font-size: 1.1rem;
      font-weight: 600;
      color: #1e3b5c;
      cursor: pointer;
      margin: 0.5rem 0 2rem 0;
      width: fit-content;
    }

    /* ========== QUOTATION SUMMARY WITH FULL TASK & MATERIAL LIST ========== */
    .summary-area {
      background: #f6faff;
      border-radius: 32px;
      padding: 2rem;
      border: 1px solid #deeaf5;
      margin-top: 2rem;
    }

    .summary-title {
      font-size: 1.5rem;
      font-weight: 650;
      margin-bottom: 1.5rem;
      color: #0b1f30;
    }

    .task-summary-card {
      background: white;
      border-radius: 20px;
      padding: 1.2rem 1.5rem;
      margin-bottom: 1.5rem;
      border: 1px solid #e2eaf2;
    }

    .task-summary-name {
      font-weight: 700;
      font-size: 1.2rem;
      color: #1f3b5c;
      margin-bottom: 0.8rem;
      border-bottom: 1px dashed #bacddc;
      padding-bottom: 0.4rem;
    }

    .material-summary-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.95rem;
    }

    .material-summary-table th {
      text-align: left;
      color: #4a617c;
      font-weight: 500;
      font-size: 0.8rem;
      text-transform: uppercase;
      padding: 0.4rem 0.2rem;
    }

    .material-summary-table td {
      padding: 0.4rem 0.2rem;
      border-bottom: 1px solid #eef3f8;
    }

    .summary-row {
      display: flex;
      justify-content: space-between;
      padding: 0.8rem 0;
      border-bottom: 1px solid #d4e0ee;
      font-size: 1.1rem;
    }

    .summary-grand {
      background: #e1ebf7;
      border-radius: 28px;
      padding: 1.2rem 2rem;
      margin-top: 1rem;
      font-weight: 800;
      font-size: 1.8rem;
      display: flex;
      justify-content: space-between;
    }
  </style>
</head>
<body>
<div class="app">
  <!-- SIDEBAR -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">PENTA<span>quote</span></div>
    <nav class="nav">
      <a href="Ex-projects.html"><span class="icon">üìÅ</span> Projects</a>
      <a href="Ex-reports.html"><span class="icon">üìä</span> Reports</a>
      <a href="Ex-Quontation.html" class="active"><span class="icon">üìã</span> Quotations</a>
    </nav>
    <div class="logout-area">
      <button class="logout-btn" id="logoutBtn"><span class="icon">üö™</span> Logout</button>
    </div>
  </aside>

  <!-- MAIN -->
  <main class="main">
    <div class="top-bar">
      <button class="toggle-btn" id="toggleSidebarBtn">‚ò∞</button>
      <span class="page-title">quotation ¬∑ full task & material list</span>
    </div>

    <div class="quotation-builder" id="quotationBuilder"></div>
  </main>
</div>

<script>
  (function() {
    // sidebar toggle (fixed)
    const sidebar = document.getElementById('sidebar');
    document.getElementById('toggleSidebarBtn').addEventListener('click', (e) => {
      e.preventDefault();
      sidebar.classList.toggle('hidden');
    });
    document.getElementById('logoutBtn').addEventListener('click', () => {
      window.location.href = 'index.html';
    });

    // ---------- QUOTATION STATE ----------
    let tasks = [
      {
        id: 'task1',
        name: 'Changing door',
        materials: [
          { id: 'm1', desc: 'Door (pre-hung)', qty: 1, price: 185.0, supplier: 'Builders Door' },
          { id: 'm2', desc: 'Mortise lock', qty: 1, price: 47.5, supplier: 'LockMart' },
          { id: 'm3', desc: 'Hinges (3 pcs)', qty: 1, price: 22.8, supplier: 'Ironmonger Co' }
        ]
      },
      {
        id: 'task2',
        name: 'Window installation',
        materials: [
          { id: 'm4', desc: 'Aluminium window', qty: 2, price: 210.0, supplier: 'Fenster Inc' },
          { id: 'm5', desc: 'Silicone sealant', qty: 3, price: 8.9, supplier: 'ChemPro' }
        ]
      }
    ];

    let indirectItems = [
      { name: 'Permit fee', value: 340 },
      { name: 'Site cleanup', value: 175 }
    ];

    let labour = 1250;
    let markup = 15;

    const container = document.getElementById('quotationBuilder');

    function render() {
      let html = `
        <div class="section-head">üìã TASKS & MATERIALS</div>
      `;

      tasks.forEach((task, tIdx) => {
        html += `
          <div class="task-card" data-task-id="${task.id}">
            <div class="task-header">
              <span class="task-name-label">task</span>
              <input type="text" class="task-name-input" value="${task.name}" data-task-idx="${tIdx}" placeholder="e.g. Changing door">
              <button class="remove-task-btn" data-task-id="${task.id}">‚úï remove task</button>
            </div>

            <table class="material-table">
              <thead>
                <tr><th>Material</th><th>Qty</th><th>Unit price ($)</th><th>Supplier</th><th></th></tr>
              </thead>
              <tbody id="mat-body-${task.id}">
        `;
        task.materials.forEach((mat, mIdx) => {
          html += `
            <tr>
              <td><input type="text" value="${mat.desc}" class="mat-desc" data-task-idx="${tIdx}" data-mat-idx="${mIdx}"></td>
              <td><input type="number" value="${mat.qty}" step="0.1" min="0" class="mat-qty" data-task-idx="${tIdx}" data-mat-idx="${mIdx}"></td>
              <td><input type="number" value="${mat.price}" step="0.01" min="0" class="mat-price" data-task-idx="${tIdx}" data-mat-idx="${mIdx}"></td>
              <td><input type="text" value="${mat.supplier}" class="mat-supplier" data-task-idx="${tIdx}" data-mat-idx="${mIdx}"></td>
              <td><button class="remove-material-btn" data-task-id="${task.id}" data-mat-id="${mat.id}">‚úï</button></td>
            </tr>
          `;
        });
        html += `
              </tbody>
            </table>
            <button class="add-material-btn" data-task-id="${task.id}">‚ûï add material to this task</button>
          </div>
        `;
      });

      html += `<button class="add-task-main-btn" id="addTaskBtn">‚ûï add new task</button>`;

      // INDIRECT COSTS
      html += `<div class="section-head">üìå INDIRECT COSTS</div>`;
      html += `<table class="indirect-table"><thead><tr><th>Cost name</th><th>Amount ($)</th><th></th></tr></thead><tbody>`;

      indirectItems.forEach((item, idx) => {
        html += `
          <tr>
            <td><input type="text" value="${item.name}" class="indirect-name" data-idx="${idx}"></td>
            <td><input type="number" value="${item.value}" step="1" min="0" class="indirect-value" data-idx="${idx}"></td>
            <td><button class="remove-indirect-btn" data-idx="${idx}">‚úï</button></td>
          </tr>
        `;
      });
      html += `</tbody></table>`;
      html += `<button class="add-indirect-btn" id="addIndirectBtn">‚ûï add indirect cost</button>`;

      // LABOUR & MARKUP
      html += `
        <div class="labour-markup-panel">
          <div class="lm-item"><label>üë∑ Labour ($)</label><input type="number" id="labourInput" value="${labour}" step="10" min="0"></div>
          <div class="lm-item"><label>üìà Markup (%)</label><input type="number" id="markupInput" value="${markup}" step="0.5" min="0"></div>
        </div>
      `;

      html += `<button class="generate-btn" id="generateBtn">‚ö° GENERATE QUOTATION (with full list)</button>`;
      html += `<div class="summary-area" id="summaryArea"></div>`;

      container.innerHTML = html;
      attachEvents();
    }

    function attachEvents() {
      // task name update
      document.querySelectorAll('.task-name-input').forEach(inp => {
        inp.addEventListener('input', e => {
          const idx = e.target.dataset.taskIdx;
          if (idx !== undefined) tasks[idx].name = e.target.value;
        });
      });

      // material field updates
      document.querySelectorAll('.mat-desc').forEach(inp => inp.addEventListener('input', updateMat));
      document.querySelectorAll('.mat-qty').forEach(inp => inp.addEventListener('input', updateMat));
      document.querySelectorAll('.mat-price').forEach(inp => inp.addEventListener('input', updateMat));
      document.querySelectorAll('.mat-supplier').forEach(inp => inp.addEventListener('input', updateMat));

      function updateMat(e) {
        const tIdx = e.target.dataset.taskIdx;
        const mIdx = e.target.dataset.matIdx;
        if (tIdx === undefined || mIdx === undefined) return;
        const task = tasks[tIdx];
        const mat = task.materials[mIdx];
        if (e.target.classList.contains('mat-desc')) mat.desc = e.target.value;
        else if (e.target.classList.contains('mat-qty')) mat.qty = parseFloat(e.target.value) || 0;
        else if (e.target.classList.contains('mat-price')) mat.price = parseFloat(e.target.value) || 0;
        else if (e.target.classList.contains('mat-supplier')) mat.supplier = e.target.value;
      }

      // remove material
      document.querySelectorAll('.remove-material-btn').forEach(btn => {
        btn.addEventListener('click', e => {
          const taskId = e.target.dataset.taskId;
          const matId = e.target.dataset.matId;
          const task = tasks.find(t => t.id === taskId);
          if (task) {
            task.materials = task.materials.filter(m => m.id !== matId);
            render();
          }
        });
      });

      // add material
      document.querySelectorAll('.add-material-btn').forEach(btn => {
        btn.addEventListener('click', e => {
          const taskId = e.target.dataset.taskId;
          const task = tasks.find(t => t.id === taskId);
          if (task) {
            const newId = 'mat_' + Date.now() + Math.random();
            task.materials.push({ id: newId, desc: 'new item', qty: 1, price: 10, supplier: '‚Äî' });
            render();
          }
        });
      });

      // remove task
      document.querySelectorAll('.remove-task-btn').forEach(btn => {
        btn.addEventListener('click', e => {
          const taskId = e.target.dataset.taskId;
          tasks = tasks.filter(t => t.id !== taskId);
          render();
        });
      });

      // add new task
      document.getElementById('addTaskBtn')?.addEventListener('click', () => {
        const newId = 'task_' + Date.now();
        tasks.push({ id: newId, name: 'New task', materials: [] });
        render();
      });

      // indirect updates
      document.querySelectorAll('.indirect-name').forEach(inp => {
        inp.addEventListener('input', e => {
          const idx = e.target.dataset.idx;
          indirectItems[idx].name = e.target.value;
        });
      });
      document.querySelectorAll('.indirect-value').forEach(inp => {
        inp.addEventListener('input', e => {
          const idx = e.target.dataset.idx;
          indirectItems[idx].value = parseFloat(e.target.value) || 0;
        });
      });
      document.querySelectorAll('.remove-indirect-btn').forEach(btn => {
        btn.addEventListener('click', e => {
          const idx = e.target.dataset.idx;
          indirectItems.splice(idx, 1);
          render();
        });
      });

      document.getElementById('addIndirectBtn')?.addEventListener('click', () => {
        indirectItems.push({ name: 'new cost', value: 100 });
        render();
      });

      // labour + markup
      const labourInp = document.getElementById('labourInput');
      const markupInp = document.getElementById('markupInput');
      if (labourInp) labourInp.addEventListener('input', e => { labour = parseFloat(e.target.value) || 0; });
      if (markupInp) markupInp.addEventListener('input', e => { markup = parseFloat(e.target.value) || 0; });

      // GENERATE with full task & material list
      document.getElementById('generateBtn')?.addEventListener('click', () => {
        // build detailed summary html
        let summaryHtml = `<div class="summary-title">üìã FULL QUOTATION ‚Äì TASKS & MATERIALS</div>`;

        tasks.forEach(task => {
          summaryHtml += `<div class="task-summary-card">`;
          summaryHtml += `<div class="task-summary-name">üî® ${task.name}</div>`;
          if (task.materials.length > 0) {
            summaryHtml += `<table class="material-summary-table"><thead><tr><th>Material</th><th>Qty</th><th>Unit price</th><th>Supplier</th><th>Amount</th></tr></thead><tbody>`;
            task.materials.forEach(m => {
              let lineTotal = m.qty * m.price;
              summaryHtml += `<tr><td>${m.desc}</td><td>${m.qty}</td><td>$${m.price.toFixed(2)}</td><td>${m.supplier}</td><td>$${lineTotal.toFixed(2)}</td></tr>`;
            });
            summaryHtml += `</tbody></table>`;
          } else {
            summaryHtml += `<p style="color:#777; padding:0.5rem 0;">no materials</p>`;
          }
          summaryHtml += `</div>`;
        });

        // indirect list
        summaryHtml += `<div style="margin-top:1.5rem;"><strong>üìå INDIRECT COSTS</strong>`;
        indirectItems.forEach(i => {
          summaryHtml += `<div style="display:flex; justify-content:space-between; padding:0.3rem 0;"><span>${i.name}</span><span>$${i.value.toFixed(2)}</span></div>`;
        });
        summaryHtml += `</div>`;

        // totals
        let matTotal = 0;
        tasks.forEach(t => t.materials.forEach(m => { matTotal += (m.qty * m.price); }));
        let indirectTotal = indirectItems.reduce((acc, i) => acc + i.value, 0);
        let subtotal = matTotal + indirectTotal + labour;
        let markupAmount = subtotal * (markup / 100);
        let grand = subtotal + markupAmount;

        summaryHtml += `<div style="margin-top:1.5rem; border-top:2px solid #cdddec; padding-top:1rem;">`;
        summaryHtml += `<div class="summary-row"><span>üî© materials total</span> <span>$${matTotal.toFixed(2)}</span></div>`;
        summaryHtml += `<div class="summary-row"><span>üì¶ indirect costs</span> <span>$${indirectTotal.toFixed(2)}</span></div>`;
        summaryHtml += `<div class="summary-row"><span>üë∑ labour</span> <span>$${labour.toFixed(2)}</span></div>`;
        summaryHtml += `<div class="summary-row"><span>üìà markup (${markup}%)</span> <span>$${markupAmount.toFixed(2)}</span></div>`;
        summaryHtml += `<div class="summary-grand"><span>üí∞ GRAND TOTAL</span> <span>$${grand.toFixed(2)}</span></div>`;
        summaryHtml += `</div>`;

        document.getElementById('summaryArea').innerHTML = summaryHtml;
      });
    }

    render();
  })();
</script>
</body>
</html>
