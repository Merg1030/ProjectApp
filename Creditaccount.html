<!DOCTYPE html>
<html>
<head>
  <title>Account Tracker</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: Arial, sans-serif;
    }
    
    body {
      padding: 20px;
      background: #f8f9fa;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    h1 {
      font-size: 18px;
      font-weight: normal;
      margin-bottom: 10px;
      color: #333;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      table-layout: fixed;
    }
    
    th {
      background: #f2f2f2;
      padding: 8px;
      text-align: left;
      border: 1px solid #ddd;
      font-weight: normal;
      font-size: 13px;
      color: #333;
      position: sticky;
      top: 0;
    }
    
    td {
      padding: 0;
      border: 1px solid #ddd;
    }
    
    input {
      width: 100%;
      height: 100%;
      padding: 8px;
      border: none;
      outline: none;
      font-size: 13px;
      background: transparent;
    }
    
    input:focus {
      background: #f8fdff;
    }
    
    .date-col { width: 100px; }
    .trans-col { width: 200px; }
    .ref-col { width: 150px; }
    .cashin-col { width: 100px; }
    .cashout-col { width: 100px; }
    .balance-col { width: 100px; }
    
    .balance-cell {
      text-align: right;
      padding: 8px;
      font-family: 'Courier New', monospace;
      background: #f9f9f9;
    }
    
    .total-row {
      background: #f2f2f2;
      font-weight: bold;
    }
    
    .total-row td {
      padding: 8px;
      border-top: 2px solid #666;
    }
    
    .controls {
      margin-top: 10px;
      font-size: 12px;
      color: #666;
    }
    
    .instructions {
      font-size: 12px;
      color: #666;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Account Tracker</h1>
    <div class="instructions">Just type in any cell. Tab to move right. Enter to add new row. Balance updates automatically.</div>
    
    <table>
      <thead>
        <tr>
          <th class="date-col">Date</th>
          <th class="trans-col">Transaction</th>
          <th class="ref-col">Reference</th>
          <th class="cashin-col">Cash In</th>
          <th class="cashout-col">Cash Out</th>
          <th class="balance-col">Balance</th>
        </tr>
      </thead>
      <tbody id="sheet">
        <!-- Rows will be added here -->
      </tbody>
    </table>
    
    <div class="controls">
      <span>Press Enter to add row • Tab to navigate • Ctrl+S to save</span>
    </div>
  </div>

  <script>
    // Sample starting data
    let data = [
      { date: '23 Jan', trans: 'top up float', ref: 'chris - hazida', cashin: '5000', cashout: '', balance: '5000' },
      { date: '23 Jan', trans: 'purchase of steel', ref: 'dominic', cashin: '', cashout: '500', balance: '4500' },
      { date: '23 Jan', trans: 'transport and lunch rations', ref: 'dabson', cashin: '', cashout: '400', balance: '4100' },
      { date: '', trans: '', ref: '', cashin: '', cashout: '', balance: '' }
    ];

    // Load from localStorage if exists
    if (localStorage.getItem('accountSheet')) {
      try {
        const saved = JSON.parse(localStorage.getItem('accountSheet'));
        if (saved && saved.length > 0) {
          data = saved;
        }
      } catch (e) {
        console.log('Could not load saved data');
      }
    }

    function renderSheet() {
      const sheet = document.getElementById('sheet');
      sheet.innerHTML = '';
      
      let runningBalance = 0;
      let totalIn = 0;
      let totalOut = 0;
      
      data.forEach((row, index) => {
        // Calculate cash values
        const cashIn = parseFloat(row.cashin) || 0;
        const cashOut = parseFloat(row.cashout) || 0;
        
        // Update running totals
        totalIn += cashIn;
        totalOut += cashOut;
        
        // Calculate balance for this row
        if (row.cashin || row.cashout) {
          runningBalance = runningBalance + cashIn - cashOut;
        }
        
        const tr = document.createElement('tr');
        
        // Date cell
        const tdDate = document.createElement('td');
        const inputDate = document.createElement('input');
        inputDate.type = 'text';
        inputDate.value = row.date;
        inputDate.placeholder = 'dd Mmm';
        inputDate.dataset.row = index;
        inputDate.dataset.col = 'date';
        tdDate.appendChild(inputDate);
        tr.appendChild(tdDate);
        
        // Transaction cell
        const tdTrans = document.createElement('td');
        const inputTrans = document.createElement('input');
        inputTrans.type = 'text';
        inputTrans.value = row.trans;
        inputTrans.placeholder = 'Description';
        inputTrans.dataset.row = index;
        inputTrans.dataset.col = 'trans';
        tdTrans.appendChild(inputTrans);
        tr.appendChild(tdTrans);
        
        // Reference cell
        const tdRef = document.createElement('td');
        const inputRef = document.createElement('input');
        inputRef.type = 'text';
        inputRef.value = row.ref;
        inputRef.placeholder = 'Reference';
        inputRef.dataset.row = index;
        inputRef.dataset.col = 'ref';
        tdRef.appendChild(inputRef);
        tr.appendChild(tdRef);
        
        // Cash In cell
        const tdIn = document.createElement('td');
        const inputIn = document.createElement('input');
        inputIn.type = 'text';
        inputIn.value = row.cashin;
        inputIn.placeholder = '0.00';
        inputIn.dataset.row = index;
        inputIn.dataset.col = 'cashin';
        tdIn.appendChild(inputIn);
        tr.appendChild(tdIn);
        
        // Cash Out cell
        const tdOut = document.createElement('td');
        const inputOut = document.createElement('input');
        inputOut.type = 'text';
        inputOut.value = row.cashout;
        inputOut.placeholder = '0.00';
        inputOut.dataset.row = index;
        inputOut.dataset.col = 'cashout';
        tdOut.appendChild(inputOut);
        tr.appendChild(tdOut);
        
        // Balance cell (readonly)
        const tdBalance = document.createElement('td');
        tdBalance.className = 'balance-cell';
        tdBalance.textContent = runningBalance === 0 ? '' : runningBalance.toLocaleString('en-US', {
          minimumFractionDigits: 2,
          maximumFractionDigits: 2
        });
        tr.appendChild(tdBalance);
        
        sheet.appendChild(tr);
        
        // Add event listeners
        [inputDate, inputTrans, inputRef, inputIn, inputOut].forEach(input => {
          input.addEventListener('input', handleInput);
          input.addEventListener('keydown', handleKeyDown);
        });
      });
      
      // Add total row
      const totalRow = document.createElement('tr');
      totalRow.className = 'total-row';
      totalRow.innerHTML = `
        <td colspan="3">TOTAL</td>
        <td>${totalIn === 0 ? '' : totalIn.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
        <td>${totalOut === 0 ? '' : totalOut.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
        <td class="balance-cell">${runningBalance === 0 ? '' : runningBalance.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
      `;
      sheet.appendChild(totalRow);
      
      // Auto-save
      autoSave();
    }

    function handleInput(e) {
      const row = parseInt(e.target.dataset.row);
      const col = e.target.dataset.col;
      const value = e.target.value;
      
      // Update data
      data[row][col] = value;
      
      // If cash in/out changed, recalculate everything
      if (col === 'cashin' || col === 'cashout') {
        // Clear all balances after this row since they need to be recalculated
        for (let i = row; i < data.length; i++) {
          data[i].balance = '';
        }
        renderSheet();
      }
    }

    function handleKeyDown(e) {
      const row = parseInt(e.target.dataset.row);
      const col = e.target.dataset.col;
      
      // Enter key - add new row
      if (e.key === 'Enter') {
        e.preventDefault();
        
        // If this is the last row, add a new one
        if (row === data.length - 1) {
          data.push({ date: '', trans: '', ref: '', cashin: '', cashout: '', balance: '' });
          renderSheet();
          
          // Focus first cell of new row
          setTimeout(() => {
            const inputs = document.querySelectorAll(`input[data-row="${row + 1}"]`);
            if (inputs[0]) inputs[0].focus();
          }, 10);
        } else {
          // Move to next row, same column
          const nextInput = document.querySelector(`input[data-row="${row + 1}"][data-col="${col}"]`);
          if (nextInput) nextInput.focus();
        }
      }
      
      // Tab key - normal tab behavior
      else if (e.key === 'Tab') {
        // Let default tab behavior happen
        setTimeout(() => {
          // If we're at the last cell of last row, add new row
          const allInputs = Array.from(document.querySelectorAll('input'));
          const currentIndex = allInputs.indexOf(e.target);
          
          if (currentIndex === allInputs.length - 1 && !e.shiftKey) {
            data.push({ date: '', trans: '', ref: '', cashin: '', cashout: '', balance: '' });
            renderSheet();
            
            setTimeout(() => {
              const newInputs = document.querySelectorAll('input');
              if (newInputs[allInputs.length]) newInputs[allInputs.length].focus();
            }, 10);
          }
        }, 10);
      }
      
      // Arrow keys for navigation
      else if (e.key === 'ArrowDown') {
        e.preventDefault();
        const nextInput = document.querySelector(`input[data-row="${row + 1}"][data-col="${col}"]`);
        if (nextInput) nextInput.focus();
      }
      else if (e.key === 'ArrowUp') {
        e.preventDefault();
        const prevInput = document.querySelector(`input[data-row="${row - 1}"][data-col="${col}"]`);
        if (prevInput) prevInput.focus();
      }
      else if (e.key === 'ArrowLeft') {
        // Normal behavior, but check if at start of cell
        if (e.target.selectionStart === 0 && e.target.selectionEnd === 0) {
          e.preventDefault();
          const cols = ['date', 'trans', 'ref', 'cashin', 'cashout'];
          const currentIndex = cols.indexOf(col);
          if (currentIndex > 0) {
            const prevInput = document.querySelector(`input[data-row="${row}"][data-col="${cols[currentIndex - 1]}"]`);
            if (prevInput) prevInput.focus();
          }
        }
      }
      else if (e.key === 'ArrowRight') {
        // Normal behavior, but check if at end of cell
        if (e.target.selectionStart === e.target.value.length && 
            e.target.selectionEnd === e.target.value.length) {
          e.preventDefault();
          const cols = ['date', 'trans', 'ref', 'cashin', 'cashout'];
          const currentIndex = cols.indexOf(col);
          if (currentIndex < cols.length - 1) {
            const nextInput = document.querySelector(`input[data-row="${row}"][data-col="${cols[currentIndex + 1]}"]`);
            if (nextInput) nextInput.focus();
          }
        }
      }
      
      // Delete row with Ctrl+Delete
      else if (e.key === 'Delete' && e.ctrlKey && data.length > 1) {
        e.preventDefault();
        data.splice(row, 1);
        renderSheet();
      }
      
      // Save with Ctrl+S
      else if (e.key === 's' && e.ctrlKey) {
        e.preventDefault();
        saveData();
        showMessage('Saved');
      }
      
      // Today's date with Ctrl+T
      else if (e.key === 't' && e.ctrlKey && col === 'date') {
        e.preventDefault();
        const today = new Date();
        const day = today.getDate();
        const month = today.toLocaleString('default', { month: 'short' });
        e.target.value = `${day} ${month}`;
        e.target.dispatchEvent(new Event('input'));
      }
    }

    function autoSave() {
      localStorage.setItem('accountSheet', JSON.stringify(data));
    }

    function saveData() {
      autoSave();
      showMessage('Saved to browser');
    }

    function showMessage(text) {
      const msg = document.createElement('div');
      msg.textContent = text;
      msg.style.cssText = `
        position: fixed;
        top: 10px;
        right: 10px;
        background: #333;
        color: white;
        padding: 5px 10px;
        border-radius: 3px;
        font-size: 12px;
        opacity: 0;
        transition: opacity 0.3s;
      `;
      document.body.appendChild(msg);
      
      setTimeout(() => msg.style.opacity = '1', 10);
      setTimeout(() => {
        msg.style.opacity = '0';
        setTimeout(() => msg.remove(), 300);
      }, 1500);
    }

    // Add some example rows
    for (let i = 0; i < 10; i++) {
      if (data.length < 10) {
        data.push({ date: '', trans: '', ref: '', cashin: '', cashout: '', balance: '' });
      }
    }

    // Initial render
    renderSheet();

    // Focus first empty cell
    setTimeout(() => {
      const inputs = document.querySelectorAll('input');
      for (let input of inputs) {
        if (!input.value) {
          input.focus();
          break;
        }
      }
    }, 100);
  </script>
</body>
</html>
