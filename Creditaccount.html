<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Simple Account Tracker</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f5f7fa;
      color: #333;
      padding: 20px;
      line-height: 1.6;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.08);
      padding: 30px;
    }
    
    h1 {
      color: #2c3e50;
      margin-bottom: 10px;
      font-size: 28px;
    }
    
    .subtitle {
      color: #7f8c8d;
      margin-bottom: 30px;
      font-size: 16px;
    }
    
    .instructions {
      background: #e8f4fc;
      padding: 15px;
      border-radius: 6px;
      margin-bottom: 25px;
      border-left: 4px solid #3498db;
    }
    
    .instructions h3 {
      color: #2c3e50;
      margin-bottom: 8px;
    }
    
    .instructions ul {
      padding-left: 20px;
    }
    
    .instructions li {
      margin-bottom: 5px;
    }
    
    .table-container {
      overflow-x: auto;
      margin-top: 20px;
      border-radius: 8px;
      border: 1px solid #e1e8ed;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 800px;
    }
    
    th {
      background: #2c3e50;
      color: white;
      padding: 14px 12px;
      text-align: left;
      font-weight: 600;
      position: sticky;
      top: 0;
      border-right: 1px solid #34495e;
    }
    
    th:last-child {
      border-right: none;
    }
    
    td {
      padding: 12px;
      border-bottom: 1px solid #e1e8ed;
    }
    
    tr:nth-child(even) {
      background: #f8f9fa;
    }
    
    tr:hover {
      background: #f0f7ff;
    }
    
    input[type="text"],
    input[type="number"] {
      width: 100%;
      padding: 10px 8px;
      border: 2px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
      font-family: inherit;
      transition: border 0.2s;
    }
    
    input[type="text"]:focus,
    input[type="number"]:focus {
      outline: none;
      border-color: #3498db;
      background: #f8fdff;
    }
    
    .date-input {
      min-width: 100px;
    }
    
    .transaction-input {
      min-width: 180px;
    }
    
    .reference-input {
      min-width: 150px;
    }
    
    .amount-input {
      min-width: 120px;
      text-align: right;
    }
    
    .balance-cell {
      font-weight: bold;
      color: #2c3e50;
      text-align: right;
      min-width: 120px;
      padding-right: 15px;
    }
    
    .add-row-btn {
      background: #27ae60;
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      margin-top: 20px;
      transition: background 0.2s;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .add-row-btn:hover {
      background: #219653;
    }
    
    .add-row-btn:active {
      transform: translateY(1px);
    }
    
    .controls {
      display: flex;
      gap: 15px;
      margin-top: 20px;
      flex-wrap: wrap;
    }
    
    .btn {
      padding: 10px 20px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      font-size: 15px;
      font-weight: 600;
      transition: all 0.2s;
    }
    
    .save-btn {
      background: #3498db;
      color: white;
    }
    
    .save-btn:hover {
      background: #2980b9;
    }
    
    .clear-btn {
      background: #e74c3c;
      color: white;
    }
    
    .clear-btn:hover {
      background: #c0392b;
    }
    
    .reset-btn {
      background: #f39c12;
      color: white;
    }
    
    .reset-btn:hover {
      background: #d68910;
    }
    
    .total-row {
      background: #2c3e50 !important;
      color: white;
      font-weight: bold;
    }
    
    .total-row td {
      padding: 14px 12px;
      font-size: 16px;
    }
    
    .cash-in {
      color: #27ae60;
    }
    
    .cash-out {
      color: #e74c3c;
    }
    
    @media (max-width: 768px) {
      .container {
        padding: 15px;
      }
      
      th, td {
        padding: 10px 8px;
        font-size: 14px;
      }
      
      .btn {
        padding: 8px 15px;
        font-size: 14px;
      }
      
      .add-row-btn {
        padding: 10px 20px;
        font-size: 15px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Simple Account Tracker</h1>
    <p class="subtitle">Type directly into the table. Balance updates automatically.</p>
    
    <div class="instructions">
      <h3>How to use:</h3>
      <ul>
        <li><strong>Just start typing</strong> in any cell</li>
        <li>Press <kbd>Tab</kbd> to move to next cell, <kbd>Shift+Tab</kbd> to go back</li>
        <li>Press <kbd>Enter</kbd> to add a new row</li>
        <li>Balance is calculated automatically based on cash in/out</li>
        <li>Click "Add New Row" button to add more rows manually</li>
      </ul>
    </div>
    
    <div class="table-container">
      <table id="accountTable">
        <thead>
          <tr>
            <th width="12%">Date</th>
            <th width="20%">Transaction</th>
            <th width="18%">Reference</th>
            <th width="15%">Cash In</th>
            <th width="15%">Cash Out</th>
            <th width="15%">Balance</th>
          </tr>
        </thead>
        <tbody id="tableBody">
          <!-- Rows will be generated here -->
        </tbody>
      </table>
    </div>
    
    <button id="addRowBtn" class="add-row-btn">
      <span>+</span> Add New Row
    </button>
    
    <div class="controls">
      <button id="saveBtn" class="btn save-btn">Save Data</button>
      <button id="clearBtn" class="btn clear-btn">Clear Table</button>
      <button id="resetBtn" class="btn reset-btn">Reset to Example</button>
    </div>
  </div>

  <script>
    // Sample data based on your example
    const sampleData = [
      { date: '23 Jan', transaction: 'top up float', reference: 'chris - hazida', cashIn: '5000', cashOut: '', balance: '5000' },
      { date: '23 Jan', transaction: 'purchase of steel', reference: 'dominic', cashIn: '', cashOut: '500', balance: '4500' },
      { date: '23 Jan', transaction: 'transport and lunch rations', reference: 'dabson', cashIn: '', cashOut: '400', balance: '4100' }
    ];

    let accountData = JSON.parse(localStorage.getItem('accountData')) || [...sampleData];

    // Initialize the table
    function initializeTable() {
      const tableBody = document.getElementById('tableBody');
      tableBody.innerHTML = '';
      
      let runningBalance = 0;
      
      accountData.forEach((row, index) => {
        // Calculate balance
        const cashIn = parseFloat(row.cashIn) || 0;
        const cashOut = parseFloat(row.cashOut) || 0;
        runningBalance = runningBalance + cashIn - cashOut;
        
        // Update the balance in the data
        accountData[index].balance = runningBalance;
        
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td><input type="text" class="date-input" value="${row.date}" data-index="${index}" data-field="date"></td>
          <td><input type="text" class="transaction-input" value="${row.transaction}" data-index="${index}" data-field="transaction"></td>
          <td><input type="text" class="reference-input" value="${row.reference}" data-index="${index}" data-field="reference"></td>
          <td><input type="number" step="0.01" class="amount-input cash-in" value="${row.cashIn || ''}" data-index="${index}" data-field="cashIn" placeholder="0.00"></td>
          <td><input type="number" step="0.01" class="amount-input cash-out" value="${row.cashOut || ''}" data-index="${index}" data-field="cashOut" placeholder="0.00"></td>
          <td class="balance-cell">${formatCurrency(runningBalance)}</td>
        `;
        tableBody.appendChild(tr);
      });
      
      addInputListeners();
      addTotalRow();
    }

    // Add total row at the bottom
    function addTotalRow() {
      const tableBody = document.getElementById('tableBody');
      
      // Remove existing total row if any
      const existingTotal = document.getElementById('totalRow');
      if (existingTotal) {
        existingTotal.remove();
      }
      
      // Calculate totals
      let totalCashIn = 0;
      let totalCashOut = 0;
      let finalBalance = 0;
      
      accountData.forEach(row => {
        totalCashIn += parseFloat(row.cashIn) || 0;
        totalCashOut += parseFloat(row.cashOut) || 0;
      });
      
      if (accountData.length > 0) {
        finalBalance = accountData[accountData.length - 1].balance || 0;
      }
      
      const totalRow = document.createElement('tr');
      totalRow.id = 'totalRow';
      totalRow.className = 'total-row';
      totalRow.innerHTML = `
        <td colspan="3" style="text-align: right;">TOTALS:</td>
        <td>${formatCurrency(totalCashIn)}</td>
        <td>${formatCurrency(totalCashOut)}</td>
        <td>${formatCurrency(finalBalance)}</td>
      `;
      tableBody.appendChild(totalRow);
    }

    // Format currency
    function formatCurrency(value) {
      if (isNaN(value) || value === 0) return '0.00';
      return parseFloat(value).toLocaleString('en-US', {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      });
    }

    // Add event listeners to inputs
    function addInputListeners() {
      const inputs = document.querySelectorAll('#tableBody input');
      
      inputs.forEach(input => {
        // Remove existing listeners to avoid duplicates
        input.removeEventListener('input', handleInput);
        input.removeEventListener('keydown', handleKeyDown);
        
        // Add new listeners
        input.addEventListener('input', handleInput);
        input.addEventListener('keydown', handleKeyDown);
      });
    }

    // Handle input changes
    function handleInput(e) {
      const index = parseInt(e.target.dataset.index);
      const field = e.target.dataset.field;
      const value = e.target.value.trim();
      
      // Update the data
      accountData[index][field] = value;
      
      // If it's a cash in/out field, recalculate balances
      if (field === 'cashIn' || field === 'cashOut') {
        recalculateBalances();
      }
      
      // Auto-save
      saveToLocalStorage();
    }

    // Handle keyboard navigation
    function handleKeyDown(e) {
      const input = e.target;
      const index = parseInt(input.dataset.index);
      
      if (e.key === 'Enter') {
        e.preventDefault();
        addNewRow();
        // Focus on the first cell of the new row
        const newIndex = accountData.length - 1;
        setTimeout(() => {
          const firstInput = document.querySelector(`input[data-index="${newIndex}"][data-field="date"]`);
          if (firstInput) firstInput.focus();
        }, 10);
      }
      
      if (e.key === 'Tab') {
        // Let default Tab behavior happen first
        setTimeout(() => {
          const allInputs = document.querySelectorAll('#tableBody input');
          const currentIndex = Array.from(allInputs).indexOf(document.activeElement);
          if (currentIndex === allInputs.length - 1 && !e.shiftKey) {
            // If we're at the last input and pressing Tab (not Shift+Tab), add a new row
            addNewRow();
            setTimeout(() => {
              const newInputs = document.querySelectorAll('#tableBody input');
              if (newInputs.length > 0) newInputs[allInputs.length].focus();
            }, 10);
          }
        }, 10);
      }
      
      // Delete row with Ctrl+Delete
      if (e.key === 'Delete' && (e.ctrlKey || e.metaKey)) {
        e.preventDefault();
        if (accountData.length > 1) {
          accountData.splice(index, 1);
          initializeTable();
          saveToLocalStorage();
        }
      }
    }

    // Recalculate all balances
    function recalculateBalances() {
      let runningBalance = 0;
      
      accountData.forEach((row, index) => {
        const cashIn = parseFloat(row.cashIn) || 0;
        const cashOut = parseFloat(row.cashOut) || 0;
        runningBalance = runningBalance + cashIn - cashOut;
        accountData[index].balance = runningBalance;
      });
      
      initializeTable();
    }

    // Add a new row
    function addNewRow() {
      accountData.push({
        date: '',
        transaction: '',
        reference: '',
        cashIn: '',
        cashOut: '',
        balance: accountData.length > 0 ? accountData[accountData.length - 1].balance : 0
      });
      
      initializeTable();
      saveToLocalStorage();
      
      // Focus on the new row's date cell
      const newIndex = accountData.length - 1;
      const newDateInput = document.querySelector(`input[data-index="${newIndex}"][data-field="date"]`);
      if (newDateInput) {
        newDateInput.focus();
      }
    }

    // Save data to localStorage
    function saveToLocalStorage() {
      localStorage.setItem('accountData', JSON.stringify(accountData));
      showNotification('Data saved!');
    }

    // Show notification
    function showNotification(message) {
      // Remove existing notification
      const existingNotif = document.querySelector('.notification');
      if (existingNotif) existingNotif.remove();
      
      const notif = document.createElement('div');
      notif.className = 'notification';
      notif.textContent = message;
      notif.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: #27ae60;
        color: white;
        padding: 12px 20px;
        border-radius: 6px;
        box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        z-index: 1000;
        font-weight: 500;
        animation: fadeIn 0.3s, fadeOut 0.3s 1.7s;
      `;
      
      document.body.appendChild(notif);
      
      setTimeout(() => {
        if (notif.parentNode) notif.parentNode.removeChild(notif);
      }, 2000);
    }

    // Add CSS for animation
    const style = document.createElement('style');
    style.textContent = `
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      @keyframes fadeOut {
        from { opacity: 1; transform: translateY(0); }
        to { opacity: 0; transform: translateY(-10px); }
      }
    `;
    document.head.appendChild(style);

    // Clear the table
    function clearTable() {
      if (confirm('Are you sure you want to clear all data? This cannot be undone.')) {
        accountData = [{
          date: '',
          transaction: '',
          reference: '',
          cashIn: '',
          cashOut: '',
          balance: 0
        }];
        initializeTable();
        saveToLocalStorage();
      }
    }

    // Reset to example data
    function resetToExample() {
      if (confirm('Reset to example data? Your current data will be replaced.')) {
        accountData = [...sampleData];
        initializeTable();
        saveToLocalStorage();
      }
    }

    // Export data as CSV
    function exportToCSV() {
      let csv = 'Date,Transaction,Reference,Cash In,Cash Out,Balance\n';
      
      accountData.forEach(row => {
        csv += `"${row.date || ''}","${row.transaction || ''}","${row.reference || ''}",${row.cashIn || 0},${row.cashOut || 0},${row.balance || 0}\n`;
      });
      
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'account-data.csv';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      window.URL.revokeObjectURL(url);
      
      showNotification('CSV exported!');
    }

    // Initialize event listeners for buttons
    document.getElementById('addRowBtn').addEventListener('click', addNewRow);
    document.getElementById('saveBtn').addEventListener('click', saveToLocalStorage);
    document.getElementById('clearBtn').addEventListener('click', clearTable);
    document.getElementById('resetBtn').addEventListener('click', resetToExample);

    // Add export button functionality
    const exportBtn = document.createElement('button');
    exportBtn.className = 'btn';
    exportBtn.textContent = 'Export CSV';
    exportBtn.style.background = '#9b59b6';
    exportBtn.style.marginLeft = '10px';
    exportBtn.onclick = exportToCSV;
    exportBtn.onmouseenter = () => exportBtn.style.background = '#8e44ad';
    exportBtn.onmouseleave = () => exportBtn.style.background = '#9b59b6';
    document.querySelector('.controls').appendChild(exportBtn);

    // Initialize the table on load
    window.addEventListener('DOMContentLoaded', initializeTable);

    // Auto-save every 30 seconds
    setInterval(saveToLocalStorage, 30000);

    // Add today's date shortcut
    document.addEventListener('keydown', function(e) {
      if ((e.ctrlKey || e.metaKey) && e.key === 'd') {
        e.preventDefault();
        const focused = document.activeElement;
        if (focused && focused.classList.contains('date-input')) {
          const today = new Date();
          const day = today.getDate();
          const month = today.toLocaleString('default', { month: 'short' });
          focused.value = `${day} ${month}`;
          focused.dispatchEvent(new Event('input'));
        }
      }
    });
  </script>
</body>
</html>
