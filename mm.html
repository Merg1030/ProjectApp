<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resource Management | Clean View</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            width: 100%;
            height: 100%;
            font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #d3dfed;
            color: #0a1c2f;
        }

        /* Main Layout */
        .main-content {
            height: 100vh;
            width: 100vw;
            display: flex;
            flex-direction: column;
            background: white;
            overflow: hidden;
        }

        /* Header */
        .app-header {
            background: #0a1c2f;
            color: white;
            padding: 4px 10px;
            border-bottom: 2px solid #1f3d62;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
            min-height: 48px;
        }

        .title-section {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .title-section h2 {
            font-size: 14px;
            font-weight: 500;
            color: white;
        }

        .back-btn {
            background: white;
            color: #0b1f33;
            border: none;
            padding: 0.2rem 1rem;
            border-radius: 30px;
            font-size: 0.7rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-decoration: none;
        }

        .back-btn:hover {
            background: #e6efff;
        }

        .header-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .add-btn {
            background: white;
            color: #0b1f33;
            border: none;
            padding: 0.2rem 1rem;
            border-radius: 30px;
            font-size: 0.7rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .add-btn:hover {
            background: #e6efff;
        }

        /* Actions Panel */
        .actions-container {
            padding: 4px 10px;
            background: #f2f6fc;
            border-bottom: 1px solid #b3c7e0;
            flex-shrink: 0;
        }

        .actions-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            padding: 2px 0;
        }

        .actions-header h3 {
            font-size: 12px;
            font-weight: 600;
            color: #0a1c2f;
        }

        .actions-header i {
            font-size: 12px;
            transition: transform 0.2s;
            color: #1f3d62;
        }

        .actions-panel {
            display: flex;
            gap: 8px;
            padding: 6px 0;
            transition: all 0.2s;
            max-height: 60px;
            overflow: hidden;
            flex-wrap: wrap;
        }

        .actions-panel.collapsed {
            max-height: 0;
            padding: 0;
            opacity: 0;
            pointer-events: none;
        }

        .btn {
            padding: 0.2rem 1rem;
            border: 1px solid #2b4a73;
            background: white;
            border-radius: 30px;
            font-size: 0.7rem;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            transition: 0.2s;
            color: #0b1f33;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .btn-primary {
            background: #0a1c2f;
            color: white;
            border: none;
        }

        .btn-primary:hover {
            background: #1f3d62;
        }

        .btn:hover {
            background: #e6efff;
        }

        .btn.btn-active {
            background: #0a1c2f;
            color: white;
            border-color: #0a1c2f;
        }

        .search-box {
            display: flex;
            align-items: center;
            background: white;
            border: 1px solid #b3c7e0;
            border-radius: 30px;
            padding: 0.2rem 0.8rem;
            min-width: 200px;
        }

        .search-box input {
            border: none;
            padding: 2px 4px;
            width: 100%;
            outline: none;
            font-size: 11px;
            background: transparent;
            color: #0a1c2f;
        }

        .search-box input::placeholder {
            color: #7f96b3;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 4px;
            background: white;
            border: 1px solid #b3c7e0;
            border-radius: 30px;
            padding: 0.2rem 0.8rem;
        }

        .filter-group label {
            font-size: 10px;
            font-weight: 600;
            color: #1f3d62;
        }

        .filter-group select {
            border: none;
            outline: none;
            font-size: 11px;
            background: transparent;
            cursor: pointer;
            color: #0a1c2f;
        }

        /* Main Container */
        .container {
            flex: 1;
            padding: 16px;
            overflow: auto;
            background: white;
            scrollbar-width: thin;
            scrollbar-color: #97adc9 #ecf2fa;
        }

        .container::-webkit-scrollbar {
            width: 10px;
            height: 10px;
            background: #ecf2fa;
        }

        .container::-webkit-scrollbar-thumb {
            background: #97adc9;
            border-radius: 8px;
            border: 2px solid #ecf2fa;
        }

        /* Tabs */
        .tab-buttons {
            display: flex;
            gap: 4px;
            margin-bottom: 16px;
            background: #f2f6fc;
            padding: 4px;
            border-radius: 8px;
            border: 1px solid #b3c7e0;
        }

        .tab-btn {
            padding: 6px 12px;
            border: none;
            background: transparent;
            color: #1f3d62;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .tab-btn i {
            font-size: 0.8rem;
        }

        .tab-btn.active {
            background: #0a1c2f;
            color: white;
        }

        .tab-btn:hover:not(.active) {
            background: #e6efff;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Tables */
        .table-wrapper {
            background: white;
            border-radius: 8px;
            border: 2px solid #1f3d62;
            overflow: auto;
            scrollbar-width: thin;
            scrollbar-color: #97adc9 #ecf2fa;
        }

        .table-wrapper::-webkit-scrollbar {
            width: 10px;
            height: 10px;
            background: #ecf2fa;
        }

        .table-wrapper::-webkit-scrollbar-thumb {
            background: #97adc9;
            border-radius: 8px;
            border: 2px solid #ecf2fa;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 11px;
            min-width: 900px;
        }

        thead th {
            background: #d4e2f2;
            color: #0a1c2f;
            padding: 8px 10px;
            text-align: left;
            font-size: 0.65rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border: 1px solid #9bb1cc;
            border-bottom: 2px solid #1f3d62;
            white-space: nowrap;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        tbody td {
            padding: 8px 10px;
            border: 1px solid #c7d6ec;
            font-size: 0.68rem;
            color: #0a1c2f;
            vertical-align: middle;
        }

        tbody tr:hover td {
            background: #e3ecf7;
        }

        /* Status Badges */
        .status-badge {
            padding: 2px 6px;
            border-radius: 30px;
            font-size: 0.55rem;
            font-weight: 700;
            border: 1px solid #9bb7da;
            display: inline-block;
            text-align: center;
            min-width: 60px;
        }

        .status-instock {
            background: #c6f6d5;
            color: #22543d;
            border-color: #22543d;
        }

        .status-lowstock {
            background: #feebc8;
            color: #744210;
            border-color: #744210;
        }

        .status-outstock {
            background: #fed7d7;
            color: #742a2a;
            border-color: #742a2a;
        }

        .status-assigned {
            background: #c6f6d5;
            color: #22543d;
            border-color: #22543d;
        }

        .status-unassigned {
            background: #feebc8;
            color: #744210;
            border-color: #744210;
        }

        .status-unavailable {
            background: #fed7d7;
            color: #742a2a;
            border-color: #742a2a;
        }

        /* Category Badge */
        .category-badge {
            background: #ebf8ff;
            color: #0a1c2f;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.6rem;
            font-weight: 600;
            border: 1px solid #9bb7da;
        }

        /* Price Display - Just digits, no USD */
        .price-display {
            font-weight: 600;
            color: #059669;
        }

        .price-empty {
            color: #7f96b3;
            font-style: italic;
        }

        .stock-warning {
            color: #cc0000;
            font-weight: 700;
        }

        /* Action Dropdown */
        .action-dropdown {
            position: relative;
            display: inline-block;
        }

        .action-btn {
            background: transparent;
            border: none;
            font-size: 1rem;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            color: #2b4a73;
        }

        .action-btn:hover {
            background: #e6efff;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            background: white;
            min-width: 140px;
            box-shadow: 0 4px 12px rgba(0,20,40,0.2);
            border-radius: 6px;
            z-index: 100;
            border: 2px solid #1f3d62;
        }

        .dropdown-content.show {
            display: block;
        }

        .dropdown-item {
            padding: 6px 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            font-size: 11px;
            color: #0a1c2f;
            border-bottom: 1px solid #b3c7e0;
        }

        .dropdown-item:last-child {
            border-bottom: none;
        }

        .dropdown-item:hover {
            background: #e6efff;
        }

        .dropdown-item i {
            width: 16px;
            font-size: 0.8rem;
        }

        .dropdown-item.edit:hover { color: #2b4a73; }
        .dropdown-item.delete:hover { color: #cc0000; }
        .dropdown-item.view:hover { color: #059669; }
        .dropdown-item.restock:hover { color: #d97706; }

        /* Labor Status Dropdown */
        .status-select {
            padding: 2px 6px;
            border-radius: 30px;
            font-size: 0.55rem;
            font-weight: 700;
            border: 1px solid;
            cursor: pointer;
            outline: none;
            width: 100px;
            background: white;
        }

        .status-select.status-assigned {
            background: #c6f6d5;
            color: #22543d;
            border-color: #22543d;
        }

        .status-select.status-unassigned {
            background: #feebc8;
            color: #744210;
            border-color: #744210;
        }

        .status-select.status-unavailable {
            background: #fed7d7;
            color: #742a2a;
            border-color: #742a2a;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #7f96b3;
            font-size: 0.8rem;
        }

        .empty-state i {
            font-size: 2rem;
            margin-bottom: 10px;
            color: #97adc9;
        }

        /* MODAL STYLES - Matching Project Tasks */
        .form-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.55);
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .form-card {
            background: white;
            width: 460px;
            border-radius: 14px;
            box-shadow: 0 24px 60px rgba(0,20,40,0.45);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            max-height: 90vh;
        }

        .modal-head {
            padding: 0.9rem 1.4rem;
            background: #0a1c2f;
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
        }

        .modal-head h3 {
            font-size: 0.95rem;
            font-weight: 600;
        }

        .close-icon {
            cursor: pointer;
            font-size: 1.1rem;
            color: #97adc9;
            transition: color 0.15s;
        }

        .close-icon:hover {
            color: white;
        }

        .modal-body {
            padding: 1.4rem 1.4rem 0.5rem;
            flex: 1;
            overflow-y: auto;
        }

        .modal-body label {
            font-size: 0.62rem;
            font-weight: 700;
            color: #7f96b3;
            text-transform: uppercase;
            letter-spacing: 0.4px;
            display: block;
            margin: 0.8rem 0 0.2rem;
        }

        .modal-body input,
        .modal-body select {
            width: 100%;
            padding: 0.6rem 0.8rem;
            border: 1px solid #b3c7e0;
            border-radius: 6px;
            font-size: 0.75rem;
            background: white;
            outline: none;
            color: #0a1c2f;
            transition: border-color 0.15s;
        }

        .modal-body input:focus,
        .modal-body select:focus {
            border-color: #2b4a73;
            box-shadow: 0 0 0 2px rgba(43,74,115,0.12);
        }

        .modal-body input[type="number"] {
            -moz-appearance: textfield;
        }

        .modal-body input[type="number"]::-webkit-outer-spin-button,
        .modal-body input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .modal-foot {
            padding: 0.75rem 1.4rem;
            border-top: 1px solid #e0e8f5;
            display: flex;
            gap: 8px;
            flex-shrink: 0;
            background: #fafcff;
        }

        .modal-foot button {
            flex: 1;
            padding: 0.6rem 1rem;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            font-size: 0.78rem;
            cursor: pointer;
            transition: all 0.15s;
        }

        .modal-foot button.btn-cancel {
            background: white;
            border: 1px solid #b3c7e0;
            color: #0a1c2f;
        }

        .modal-foot button.btn-cancel:hover {
            background: #e6efff;
        }

        .modal-foot button.btn-primary {
            background: #059669;
            color: white;
        }

        .modal-foot button.btn-primary:hover {
            background: #047857;
        }

        .modal-foot button.btn-save {
            background: #0a1c2f;
            color: white;
        }

        .modal-foot button.btn-save:hover {
            background: #1f3d62;
        }

        /* Restock History Modal */
        .history-modal {
            max-width: 800px;
            width: 90vw;
        }

        .history-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.7rem;
        }

        .history-table th {
            background: #d4e2f2;
            padding: 6px 8px;
            border: 1px solid #9bb1cc;
            font-size: 0.6rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .history-table td {
            padding: 6px 8px;
            border: 1px solid #c7d6ec;
        }

        .history-table tr:hover td {
            background: #f4f8fd;
        }

        /* Stats Cards - Simplified */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-bottom: 16px;
        }

        .stat-card {
            background: #f2f6fc;
            border: 1px solid #b3c7e0;
            border-radius: 8px;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .stat-icon {
            width: 40px;
            height: 40px;
            background: #d4e2f2;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #0a1c2f;
            font-size: 1.2rem;
        }

        .stat-content h4 {
            font-size: 0.7rem;
            color: #7f96b3;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-content .stat-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: #0a1c2f;
        }

        .stat-content .stat-sub {
            font-size: 0.65rem;
            color: #059669;
        }
    </style>
</head>
<body>
    <main class="main-content">
        <!-- Header -->
        <div class="app-header">
            <div class="title-section">
                <i class="fas fa-cubes" style="font-size:16px;"></i>
                <h2 id="projectTitle">Resource Management</h2>
            </div>
            <div class="header-buttons">
                <button class="add-btn" id="addBtn"><i class="fas fa-plus"></i> Add</button>
                <a href="dashboard.html" class="back-btn"><i class="fas fa-arrow-left"></i> Dashboard</a>
            </div>
        </div>

        <!-- Actions Panel -->
        <div class="actions-container">
            <div class="actions-header" id="actionsHeader">
                <h3><i class="fas fa-sliders-h"></i> Filters & Actions</h3>
                <i class="fas fa-chevron-down" id="toggleIcon"></i>
            </div>
            <div class="actions-panel" id="actionsPanel">
                <div class="search-box">
                    <i class="fas fa-search" style="color:#7f96b3;"></i>
                    <input type="text" id="searchInput" placeholder="Search resources...">
                </div>
                <div class="filter-group">
                    <label>Status:</label>
                    <select id="statusFilter">
                        <option value="">All</option>
                        <option value="instock">In Stock</option>
                        <option value="lowstock">Low Stock</option>
                        <option value="outstock">Out of Stock</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Category:</label>
                    <select id="categoryFilter">
                        <option value="">All</option>
                        <option value="Structural">Structural</option>
                        <option value="Finishing">Finishing</option>
                        <option value="Electrical">Electrical</option>
                        <option value="Plumbing">Plumbing</option>
                        <option value="HVAC">HVAC</option>
                    </select>
                </div>
                <button class="btn" id="restockHistoryBtn"><i class="fas fa-history"></i> Restock History</button>
                <button class="btn" id="exportBtn"><i class="fas fa-download"></i> Export</button>
            </div>
        </div>

        <!-- Main Container -->
        <div class="container">
            <!-- Stats Cards - Simplified -->
            <div class="stats-grid" id="statsGrid">
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-cube"></i></div>
                    <div class="stat-content">
                        <h4>Total Materials</h4>
                        <span class="stat-value" id="totalMaterials">0</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-exclamation-triangle"></i></div>
                    <div class="stat-content">
                        <h4>Low Stock Items</h4>
                        <span class="stat-value" id="lowStockCount">0</span>
                        <span class="stat-sub">Need reorder</span>
                    </div>
                </div>
            </div>

            <!-- TABS -->
            <div class="tab-buttons">
                <button class="tab-btn active" onclick="switchTab('materials')">
                    <i class="fas fa-cube"></i> Materials
                </button>
                <button class="tab-btn" onclick="switchTab('labor')">
                    <i class="fas fa-hardhat"></i> Labor
                </button>
            </div>

            <!-- MATERIALS TAB -->
            <div id="materials" class="tab-content active">
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Material Name</th>
                                <th>Category</th>
                                <th>Available Stock</th>
                                <th>Status</th>
                                <th>Location</th>
                                <th>Price</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="materialBody"></tbody>
                    </table>
                    <div id="materialEmpty" class="empty-state" style="display:none;">
                        <i class="fas fa-box-open"></i>
                        <p>No materials added yet</p>
                    </div>
                </div>
            </div>

            <!-- LABOR TAB -->
            <div id="labor" class="tab-content">
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Employee ID</th>
                                <th>Name</th>
                                <th>Surname</th>
                                <th>Role</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="laborBody"></tbody>
                    </table>
                    <div id="laborEmpty" class="empty-state" style="display:none;">
                        <i class="fas fa-users"></i>
                        <p>No employees added yet</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- MATERIAL FORM MODAL -->
    <div class="form-overlay" id="materialFormOverlay">
        <div class="form-card">
            <div class="modal-head">
                <h3 id="materialFormTitle"><i class="fas fa-plus"></i> Add Material</h3>
                <i class="fas fa-times close-icon" id="closeMaterialForm"></i>
            </div>
            <div class="modal-body">
                <label>Material Name</label>
                <input type="text" id="materialNameInput" placeholder="e.g., Concrete, Steel, Bricks">

                <label>Category</label>
                <select id="materialCategoryInput">
                    <option value="">Select Category</option>
                    <option value="Structural">Structural</option>
                    <option value="Finishing">Finishing</option>
                    <option value="Electrical">Electrical</option>
                    <option value="Plumbing">Plumbing</option>
                    <option value="HVAC">HVAC</option>
                    <option value="Safety">Safety</option>
                    <option value="Other">Other</option>
                </select>

                <label>Available Stock</label>
                <input type="number" id="materialQuantityInput" placeholder="0" min="0">

                <label>Location</label>
                <input type="text" id="materialLocationInput" placeholder="e.g., Storage A, Site B">

                <label>Unit Price</label>
                <input type="number" id="materialPriceInput" placeholder="0" min="0" step="0.01">
            </div>
            <div class="modal-foot">
                <button class="btn-cancel" id="cancelMaterialBtn">Cancel</button>
                <button class="btn-save" id="saveMaterialBtn">Save Material</button>
            </div>
        </div>
    </div>

    <!-- LABOR FORM MODAL -->
    <div class="form-overlay" id="laborFormOverlay">
        <div class="form-card">
            <div class="modal-head">
                <h3 id="laborFormTitle"><i class="fas fa-plus"></i> Add Employee</h3>
                <i class="fas fa-times close-icon" id="closeLaborForm"></i>
            </div>
            <div class="modal-body">
                <label>Employee ID</label>
                <input type="text" id="empIdInput" placeholder="e.g., EMP001">

                <label>Name</label>
                <input type="text" id="nameInput" placeholder="First name">

                <label>Surname</label>
                <input type="text" id="surnameInput" placeholder="Last name">

                <label>Role</label>
                <select id="roleInput">
                    <option value="Employee">Employee</option>
                    <option value="Supervisor">Supervisor</option>
                    <option value="Manager">Manager</option>
                    <option value="Engineer">Engineer</option>
                    <option value="Technician">Technician</option>
                </select>

                <label>Status</label>
                <select id="laborStatusInput">
                    <option value="assigned">Assigned</option>
                    <option value="unassigned">Unassigned</option>
                    <option value="unavailable">Unavailable</option>
                </select>
            </div>
            <div class="modal-foot">
                <button class="btn-cancel" id="cancelLaborBtn">Cancel</button>
                <button class="btn-save" id="saveLaborBtn">Save Employee</button>
            </div>
        </div>
    </div>

    <!-- RESTOCK MODAL -->
    <div class="form-overlay" id="restockFormOverlay">
        <div class="form-card">
            <div class="modal-head">
                <h3><i class="fas fa-plus-circle"></i> Restock Material</h3>
                <i class="fas fa-times close-icon" id="closeRestockForm"></i>
            </div>
            <div class="modal-body">
                <label>Material</label>
                <input type="text" id="restockMaterialName" readonly style="background:#f2f6fc;">

                <label>Current Stock</label>
                <input type="text" id="restockCurrentStock" readonly style="background:#f2f6fc;">

                <label>Quantity to Add</label>
                <input type="number" id="restockQuantity" placeholder="Enter quantity" min="1" step="1">

                <label>Unit Price <span style="color:#7f96b3;">(optional - updates if changed)</span></label>
                <input type="number" id="restockPrice" placeholder="Enter new unit price or leave blank" min="0" step="0.01">

                <label>Notes</label>
                <input type="text" id="restockNotes" placeholder="e.g., Supplier name, order #">
            </div>
            <div class="modal-foot">
                <button class="btn-cancel" id="cancelRestockBtn">Cancel</button>
                <button class="btn-primary" id="saveRestockBtn">Complete Restock</button>
            </div>
        </div>
    </div>

    <!-- RESTOCK HISTORY MODAL -->
    <div class="form-overlay" id="restockHistoryOverlay">
        <div class="form-card history-modal">
            <div class="modal-head">
                <h3><i class="fas fa-history"></i> Restock History</h3>
                <i class="fas fa-times close-icon" id="closeHistoryBtn"></i>
            </div>
            <div class="modal-body" style="padding:0;">
                <div style="overflow:auto; max-height:400px;">
                    <table class="history-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Material</th>
                                <th>Added Qty</th>
                                <th>Previous</th>
                                <th>New Stock</th>
                                <th>Price</th>
                                <th>Notes</th>
                            </tr>
                        </thead>
                        <tbody id="restockHistoryBody"></tbody>
                    </table>
                </div>
                <div id="restockHistoryEmpty" class="empty-state" style="display:none; padding:20px;">
                    <i class="fas fa-history"></i>
                    <p>No restock history yet</p>
                </div>
            </div>
            <div class="modal-foot">
                <button class="btn-cancel" style="flex:0 1 auto;" onclick="closeHistoryModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

    <script>
        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyDXhhy94Aqmaav6X0UsfMcmsBT539-aheU",
            authDomain: "project-task-588c4.firebaseapp.com",
            projectId: "project-task-588c4",
            storageBucket: "project-task-588c4.appspot.com",
            messagingSenderId: "411882772509",
            appId: "1:411882772509:web:08d613186c101a99f38ef4"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // State
        let materialsData = [];
        let laborData = [];
        let restockHistory = [];
        let currentTab = 'materials';
        let editingId = null;
        let editingType = null;
        let currentRestockMaterial = null;

        // Actions panel collapse
        let actionsCollapsed = localStorage.getItem('actionsCollapsed') === 'true';
        const actionsHeader = document.getElementById('actionsHeader');
        const actionsPanel = document.getElementById('actionsPanel');
        const toggleIcon = document.getElementById('toggleIcon');

        if (actionsCollapsed) {
            actionsPanel.classList.add('collapsed');
            toggleIcon.style.transform = 'rotate(-90deg)';
        }

        actionsHeader.addEventListener('click', () => {
            actionsPanel.classList.toggle('collapsed');
            toggleIcon.style.transform = actionsPanel.classList.contains('collapsed') ? 'rotate(-90deg)' : '';
            localStorage.setItem('actionsCollapsed', actionsPanel.classList.contains('collapsed'));
        });

        // DOM Elements
        const addBtn = document.getElementById('addBtn');
        const materialBody = document.getElementById('materialBody');
        const laborBody = document.getElementById('laborBody');
        const materialEmpty = document.getElementById('materialEmpty');
        const laborEmpty = document.getElementById('laborEmpty');
        const searchInput = document.getElementById('searchInput');
        const statusFilter = document.getElementById('statusFilter');
        const categoryFilter = document.getElementById('categoryFilter');
        
        // Stats elements - removed total employees
        const totalMaterialsEl = document.getElementById('totalMaterials');
        const lowStockCountEl = document.getElementById('lowStockCount');

        // Material Modal Elements
        const materialFormOverlay = document.getElementById('materialFormOverlay');
        const closeMaterialForm = document.getElementById('closeMaterialForm');
        const cancelMaterialBtn = document.getElementById('cancelMaterialBtn');
        const saveMaterialBtn = document.getElementById('saveMaterialBtn');
        const materialNameInput = document.getElementById('materialNameInput');
        const materialCategoryInput = document.getElementById('materialCategoryInput');
        const materialQuantityInput = document.getElementById('materialQuantityInput');
        const materialLocationInput = document.getElementById('materialLocationInput');
        const materialPriceInput = document.getElementById('materialPriceInput');
        const materialFormTitle = document.getElementById('materialFormTitle');

        // Labor Modal Elements
        const laborFormOverlay = document.getElementById('laborFormOverlay');
        const closeLaborForm = document.getElementById('closeLaborForm');
        const cancelLaborBtn = document.getElementById('cancelLaborBtn');
        const saveLaborBtn = document.getElementById('saveLaborBtn');
        const empIdInput = document.getElementById('empIdInput');
        const nameInput = document.getElementById('nameInput');
        const surnameInput = document.getElementById('surnameInput');
        const roleInput = document.getElementById('roleInput');
        const laborStatusInput = document.getElementById('laborStatusInput');
        const laborFormTitle = document.getElementById('laborFormTitle');

        // Restock Elements
        const restockFormOverlay = document.getElementById('restockFormOverlay');
        const restockHistoryOverlay = document.getElementById('restockHistoryOverlay');
        const restockMaterialName = document.getElementById('restockMaterialName');
        const restockCurrentStock = document.getElementById('restockCurrentStock');
        const restockQuantity = document.getElementById('restockQuantity');
        const restockPrice = document.getElementById('restockPrice');
        const restockNotes = document.getElementById('restockNotes');
        const closeRestockForm = document.getElementById('closeRestockForm');
        const cancelRestockBtn = document.getElementById('cancelRestockBtn');
        const saveRestockBtn = document.getElementById('saveRestockBtn');
        const restockHistoryBtn = document.getElementById('restockHistoryBtn');
        const closeHistoryBtn = document.getElementById('closeHistoryBtn');
        const restockHistoryBody = document.getElementById('restockHistoryBody');
        const restockHistoryEmpty = document.getElementById('restockHistoryEmpty');
        const exportBtn = document.getElementById('exportBtn');

        // Go Back function
        window.goBack = function() {
            window.history.back();
        };

        // Tab switching
        window.switchTab = function(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(tab).classList.add('active');
            
            // Update active button
            document.querySelectorAll('.tab-btn').forEach((btn, index) => {
                if ((tab === 'materials' && index === 0) || (tab === 'labor' && index === 1)) {
                    btn.classList.add('active');
                }
            });
            
            closeAllDropdowns();
        };

        // Close all dropdowns
        function closeAllDropdowns() {
            document.querySelectorAll('.dropdown-content.show').forEach(dropdown => {
                dropdown.classList.remove('show');
            });
        }

        // Toggle dropdown
        window.toggleDropdown = function(event, id) {
            event.stopPropagation();
            closeAllDropdowns();
            
            const dropdown = document.getElementById(`dropdown-${id}`);
            if (dropdown) {
                dropdown.classList.toggle('show');
            }
        };

        // Close dropdowns when clicking outside
        document.addEventListener('click', function(event) {
            if (!event.target.closest('.action-dropdown')) {
                closeAllDropdowns();
            }
        });

        // Add button
        addBtn.addEventListener('click', () => {
            if (currentTab === 'materials') {
                openMaterialForm();
            } else {
                openLaborForm();
            }
        });

        // ========== MATERIAL FUNCTIONS ==========
        function openMaterialForm() {
            editingId = null;
            editingType = 'material';
            materialFormTitle.innerHTML = '<i class="fas fa-plus"></i> Add Material';
            materialNameInput.value = '';
            materialCategoryInput.value = '';
            materialQuantityInput.value = '';
            materialLocationInput.value = '';
            materialPriceInput.value = '';
            materialFormOverlay.style.display = 'flex';
        }

        window.editMaterial = function(id) {
            const material = materialsData.find(m => m.id === id);
            if (!material) return;

            editingId = id;
            editingType = 'material';
            materialFormTitle.innerHTML = '<i class="fas fa-edit"></i> Edit Material';
            materialNameInput.value = material.materialName || '';
            materialCategoryInput.value = material.category || '';
            materialQuantityInput.value = material.quantity || '';
            materialLocationInput.value = material.location || '';
            materialPriceInput.value = material.price || '';
            materialFormOverlay.style.display = 'flex';
            closeAllDropdowns();
        };

        window.deleteMaterial = function(id) {
            if (confirm('Delete this material? This will also delete its restock history.')) {
                // Delete restock history first
                db.collection("restockHistory")
                    .where("materialId", "==", id)
                    .get()
                    .then((snapshot) => {
                        const batch = db.batch();
                        snapshot.docs.forEach(doc => {
                            batch.delete(doc.ref);
                        });
                        batch.delete(db.collection("materials").doc(id));
                        return batch.commit();
                    })
                    .catch(error => console.error("Error deleting:", error));
            }
            closeAllDropdowns();
        };

        window.restockMaterial = function(id) {
            const material = materialsData.find(m => m.id === id);
            if (!material) return;
            
            currentRestockMaterial = material;
            restockMaterialName.value = material.materialName || 'Unknown';
            restockCurrentStock.value = material.quantity || 0;
            restockQuantity.value = '';
            restockPrice.value = '';
            restockNotes.value = '';
            restockFormOverlay.style.display = 'flex';
            closeAllDropdowns();
        };

        saveRestockBtn.addEventListener('click', async () => {
            if (!currentRestockMaterial) return;
            
            const addQty = parseInt(restockQuantity.value);
            if (!addQty || addQty <= 0) {
                alert('Please enter a valid quantity to add');
                return;
            }

            const currentStock = parseInt(currentRestockMaterial.quantity) || 0;
            const newStock = currentStock + addQty;
            const newPrice = restockPrice.value ? parseFloat(restockPrice.value) : currentRestockMaterial.price;
            const notes = restockNotes.value.trim();

            try {
                // Update material
                await db.collection("materials").doc(currentRestockMaterial.id).update({
                    quantity: newStock,
                    price: newPrice || currentRestockMaterial.price,
                    updatedAt: new Date()
                });

                // Add restock history
                await db.collection("restockHistory").add({
                    materialId: currentRestockMaterial.id,
                    materialName: currentRestockMaterial.materialName,
                    previousStock: currentStock,
                    addedQuantity: addQty,
                    newStock: newStock,
                    previousPrice: currentRestockMaterial.price,
                    newPrice: newPrice || currentRestockMaterial.price,
                    notes: notes,
                    createdAt: new Date()
                });

                closeRestockModal();
                alert(`Successfully added ${addQty} units to ${currentRestockMaterial.materialName}`);
            } catch (error) {
                console.error("Error restocking:", error);
                alert('Error restocking material');
            }
        });

        function closeRestockModal() {
            restockFormOverlay.style.display = 'none';
            currentRestockMaterial = null;
        }

        // View restock history
        restockHistoryBtn.addEventListener('click', () => {
            loadRestockHistory();
        });

        function loadRestockHistory() {
            db.collection("restockHistory")
                .orderBy("createdAt", "desc")
                .get()
                .then((snapshot) => {
                    restockHistory = [];
                    snapshot.forEach(doc => {
                        restockHistory.push({ id: doc.id, ...doc.data() });
                    });
                    renderRestockHistory();
                    restockHistoryOverlay.style.display = 'flex';
                })
                .catch(error => console.error("Error loading history:", error));
        }

        function renderRestockHistory() {
            if (restockHistory.length === 0) {
                restockHistoryBody.innerHTML = '';
                restockHistoryEmpty.style.display = 'block';
                return;
            }

            restockHistoryEmpty.style.display = 'none';
            
            let html = '';
            restockHistory.forEach(entry => {
                const date = entry.createdAt?.toDate ? 
                    entry.createdAt.toDate().toLocaleString() : 
                    new Date(entry.createdAt).toLocaleString();
                
                html += `
                    <tr>
                        <td>${date}</td>
                        <td><strong>${entry.materialName || 'Unknown'}</strong></td>
                        <td style="color:#059669; font-weight:700;">+${entry.addedQuantity}</td>
                        <td>${entry.previousStock}</td>
                        <td>${entry.newStock}</td>
                        <td>${entry.newPrice?.toFixed(2) || '—'}</td>
                        <td>${entry.notes || '—'}</td>
                    </tr>
                `;
            });
            
            restockHistoryBody.innerHTML = html;
        }

        window.closeHistoryModal = function() {
            restockHistoryOverlay.style.display = 'none';
        };

        closeHistoryBtn.addEventListener('click', closeHistoryModal);
        closeRestockForm.addEventListener('click', closeRestockModal);
        cancelRestockBtn.addEventListener('click', closeRestockModal);

        saveMaterialBtn.addEventListener('click', async () => {
            const materialName = materialNameInput.value.trim();
            const category = materialCategoryInput.value;
            const quantity = parseInt(materialQuantityInput.value) || 0;
            const location = materialLocationInput.value.trim();
            const price = parseFloat(materialPriceInput.value) || 0;

            if (!materialName) {
                alert('Please enter material name');
                return;
            }

            const materialData = {
                materialName,
                category: category || 'Uncategorized',
                quantity,
                location: location || 'Main Storage',
                price: price,
                updatedAt: new Date()
            };

            if (!editingId) {
                materialData.createdAt = new Date();
            }

            try {
                if (editingId && editingType === 'material') {
                    await db.collection("materials").doc(editingId).update(materialData);
                } else {
                    await db.collection("materials").add(materialData);
                }
                closeMaterialModal();
            } catch (error) {
                console.error("Error saving:", error);
                alert('Error saving material');
            }
        });

        function closeMaterialModal() {
            materialFormOverlay.style.display = 'none';
            editingId = null;
            editingType = null;
        }

        closeMaterialForm.addEventListener('click', closeMaterialModal);
        cancelMaterialBtn.addEventListener('click', closeMaterialModal);

        // ========== LABOR FUNCTIONS ==========
        function openLaborForm() {
            editingId = null;
            editingType = 'labor';
            laborFormTitle.innerHTML = '<i class="fas fa-plus"></i> Add Employee';
            empIdInput.value = '';
            nameInput.value = '';
            surnameInput.value = '';
            roleInput.value = 'Employee';
            laborStatusInput.value = 'unassigned';
            laborFormOverlay.style.display = 'flex';
        }

        window.editLabor = function(id) {
            const employee = laborData.find(e => e.id === id);
            if (!employee) return;

            editingId = id;
            editingType = 'labor';
            laborFormTitle.innerHTML = '<i class="fas fa-edit"></i> Edit Employee';
            empIdInput.value = employee.empId || '';
            nameInput.value = employee.name || '';
            surnameInput.value = employee.surname || '';
            roleInput.value = employee.role || 'Employee';
            laborStatusInput.value = employee.status || 'unassigned';
            laborFormOverlay.style.display = 'flex';
            closeAllDropdowns();
        };

        window.deleteLabor = function(id) {
            if (confirm('Delete this employee?')) {
                db.collection("employees").doc(id).delete()
                    .catch(error => console.error("Error deleting:", error));
            }
            closeAllDropdowns();
        };

        window.viewEmployee = function(id) {
            window.location.href = `viewemployee.html?id=${id}`;
        };

        window.updateLaborStatus = function(id, newStatus) {
            db.collection("employees").doc(id).update({ 
                status: newStatus,
                updatedAt: new Date()
            }).catch(error => console.error("Error updating status:", error));
        };

        saveLaborBtn.addEventListener('click', async () => {
            const empId = empIdInput.value.trim();
            const name = nameInput.value.trim();
            const surname = surnameInput.value.trim();
            const role = roleInput.value;
            const status = laborStatusInput.value;

            if (!name || !surname) {
                alert('Please enter name and surname');
                return;
            }

            const laborData = {
                empId: empId || `EMP${Date.now()}`,
                name,
                surname,
                role: role,
                status: status,
                updatedAt: new Date()
            };

            if (!editingId) {
                laborData.createdAt = new Date();
            }

            try {
                if (editingId && editingType === 'labor') {
                    await db.collection("employees").doc(editingId).update(laborData);
                } else {
                    await db.collection("employees").add(laborData);
                }
                closeLaborModal();
            } catch (error) {
                console.error("Error saving:", error);
                alert('Error saving employee');
            }
        });

        function closeLaborModal() {
            laborFormOverlay.style.display = 'none';
            editingId = null;
            editingType = null;
        }

        closeLaborForm.addEventListener('click', closeLaborModal);
        cancelLaborBtn.addEventListener('click', closeLaborModal);

        // ========== LOAD MATERIALS ==========
        db.collection("materials")
            .orderBy("createdAt", "desc")
            .onSnapshot((snapshot) => {
                materialsData = [];
                snapshot.forEach(doc => {
                    const data = doc.data();
                    data.id = doc.id;
                    materialsData.push(data);
                });
                applyFilters();
            });

        // ========== LOAD EMPLOYEES ==========
        db.collection("employees")
            .orderBy("createdAt", "desc")
            .onSnapshot((snapshot) => {
                laborData = [];
                snapshot.forEach(doc => {
                    const data = doc.data();
                    data.id = doc.id;
                    laborData.push(data);
                });
                renderLabor();
            });

        // Filter and search
        function applyFilters() {
            let filtered = [...materialsData];
            
            const search = searchInput.value.toLowerCase();
            const status = statusFilter.value;
            const category = categoryFilter.value;

            if (search) {
                filtered = filtered.filter(m => 
                    (m.materialName?.toLowerCase() || '').includes(search) ||
                    (m.category?.toLowerCase() || '').includes(search) ||
                    (m.location?.toLowerCase() || '').includes(search)
                );
            }

            if (category) {
                filtered = filtered.filter(m => m.category === category);
            }

            if (status) {
                filtered = filtered.filter(m => {
                    const qty = parseInt(m.quantity) || 0;
                    if (status === 'instock') return qty > 20;
                    if (status === 'lowstock') return qty > 0 && qty <= 20;
                    if (status === 'outstock') return qty === 0;
                    return true;
                });
            }

            renderMaterials(filtered);
            updateStats();
        }

        searchInput.addEventListener('input', applyFilters);
        statusFilter.addEventListener('change', applyFilters);
        categoryFilter.addEventListener('change', applyFilters);

        function renderMaterials(filteredData = materialsData) {
            if (filteredData.length === 0) {
                materialBody.innerHTML = '';
                materialEmpty.style.display = 'block';
                return;
            }

            materialEmpty.style.display = 'none';
            
            let html = '';
            let row = 1;
            
            filteredData.forEach(m => {
                const quantity = parseInt(m.quantity) || 0;
                
                let statusClass = 'status-instock';
                let statusText = 'In Stock';
                
                if (quantity === 0) {
                    statusClass = 'status-outstock';
                    statusText = 'Out of Stock';
                } else if (quantity < 20) {
                    statusClass = 'status-lowstock';
                    statusText = 'Low Stock';
                }
                
                const priceDisplay = m.price ? parseFloat(m.price).toFixed(2) : '<span class="price-empty">—</span>';
                
                html += `
                    <tr>
                        <td>${row++}</td>
                        <td><strong>${m.materialName || '-'}</strong></td>
                        <td><span class="category-badge">${m.category || 'Uncategorized'}</span></td>
                        <td class="${quantity < 20 ? 'stock-warning' : ''}"><strong>${quantity}</strong></td>
                        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                        <td>${m.location || 'Storage A'}</td>
                        <td class="price-display">${priceDisplay}</td>
                        <td>
                            <div class="action-dropdown">
                                <button class="action-btn" onclick="toggleDropdown(event, 'material-${m.id}')">
                                    <i class="fas fa-ellipsis-v"></i>
                                </button>
                                <div class="dropdown-content" id="dropdown-material-${m.id}">
                                    <div class="dropdown-item restock" onclick="restockMaterial('${m.id}')">
                                        <i class="fas fa-plus-circle"></i> Restock
                                    </div>
                                    <div class="dropdown-item edit" onclick="editMaterial('${m.id}')">
                                        <i class="fas fa-edit"></i> Edit
                                    </div>
                                    <div class="dropdown-item delete" onclick="deleteMaterial('${m.id}')">
                                        <i class="fas fa-trash-alt"></i> Delete
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            materialBody.innerHTML = html;
        }

        function renderLabor() {
            if (laborData.length === 0) {
                laborBody.innerHTML = '';
                laborEmpty.style.display = 'block';
                return;
            }

            laborEmpty.style.display = 'none';
            
            let html = '';
            let row = 1;
            
            laborData.forEach(e => {
                const roleDisplay = e.role || 'Employee';
                const status = e.status || 'unassigned';
                
                let statusClass = '';
                if (status === 'assigned') statusClass = 'status-assigned';
                else if (status === 'unassigned') statusClass = 'status-unassigned';
                else if (status === 'unavailable') statusClass = 'status-unavailable';
                
                html += `
                    <tr>
                        <td>${row++}</td>
                        <td>${e.empId || '-'}</td>
                        <td>${e.name || '-'}</td>
                        <td>${e.surname || '-'}</td>
                        <td><span class="category-badge">${roleDisplay}</span></td>
                        <td>
                            <select class="status-select ${statusClass}" onchange="updateLaborStatus('${e.id}', this.value)">
                                <option value="assigned" ${status === 'assigned' ? 'selected' : ''}>Assigned</option>
                                <option value="unassigned" ${status === 'unassigned' ? 'selected' : ''}>Unassigned</option>
                                <option value="unavailable" ${status === 'unavailable' ? 'selected' : ''}>Unavailable</option>
                            </select>
                        </td>
                        <td>
                            <div class="action-dropdown">
                                <button class="action-btn" onclick="toggleDropdown(event, 'labor-${e.id}')">
                                    <i class="fas fa-ellipsis-v"></i>
                                </button>
                                <div class="dropdown-content" id="dropdown-labor-${e.id}">
                                    <div class="dropdown-item view" onclick="viewEmployee('${e.id}')">
                                        <i class="fas fa-eye"></i> View
                                    </div>
                                    <div class="dropdown-item edit" onclick="editLabor('${e.id}')">
                                        <i class="fas fa-edit"></i> Edit
                                    </div>
                                    <div class="dropdown-item delete" onclick="deleteLabor('${e.id}')">
                                        <i class="fas fa-trash-alt"></i> Delete
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            laborBody.innerHTML = html;
        }

        function updateStats() {
            // Material stats only - removed total value
            const totalMaterials = materialsData.length;
            let lowStock = 0;
            
            materialsData.forEach(m => {
                const qty = parseInt(m.quantity) || 0;
                if (qty > 0 && qty < 20) lowStock++;
            });
            
            totalMaterialsEl.textContent = totalMaterials;
            lowStockCountEl.textContent = lowStock;
        }

        // Export functionality
        exportBtn.addEventListener('click', () => {
            let data;
            let filename;
            
            if (currentTab === 'materials') {
                data = materialsData.map(m => ({
                    'Material Name': m.materialName,
                    'Category': m.category,
                    'Stock': m.quantity,
                    'Location': m.location,
                    'Price': m.price || '-',
                    'Status': getStatusText(m.quantity)
                }));
                filename = 'materials-export.json';
            } else {
                data = laborData.map(e => ({
                    'Employee ID': e.empId,
                    'Name': e.name,
                    'Surname': e.surname,
                    'Role': e.role,
                    'Status': e.status
                }));
                filename = 'employees-export.json';
            }
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
        });

        function getStatusText(quantity) {
            const qty = parseInt(quantity) || 0;
            if (qty === 0) return 'Out of Stock';
            if (qty < 20) return 'Low Stock';
            return 'In Stock';
        }

        // ========== CLOSE MODALS ON OVERLAY CLICK ==========
        materialFormOverlay.addEventListener('click', (e) => {
            if (e.target === materialFormOverlay) closeMaterialModal();
        });

        laborFormOverlay.addEventListener('click', (e) => {
            if (e.target === laborFormOverlay) closeLaborModal();
        });

        restockFormOverlay.addEventListener('click', (e) => {
            if (e.target === restockFormOverlay) closeRestockModal();
        });

        restockHistoryOverlay.addEventListener('click', (e) => {
            if (e.target === restockHistoryOverlay) closeHistoryModal();
        });

        // ========== KEYBOARD SHORTCUTS ==========
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeMaterialModal();
                closeLaborModal();
                closeRestockModal();
                closeHistoryModal();
                closeAllDropdowns();
            }
        });
    </script>
</body>
</html>
